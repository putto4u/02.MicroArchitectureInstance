제시해주신 Ubuntu 환경에서의 BIND9 DNS 서버 구축 실습 내용을 바탕으로, 모든 코드 라인에 상세한 주석을 추가하여 강의 교재 형식으로 재구성하였습니다.

---

## BIND9 패키지 설치 및 초기화

Ubuntu 시스템의 패키지 관리자를 사용하여 DNS 서비스 운영에 필요한 핵심 패키지들을 설치합니다.

```bash
# 시스템의 패키지 인덱스 정보를 최신 상태로 업데이트하여 설치 가능한 소프트웨어 목록을 갱신합니다.
sudo apt update

# bind9: DNS 서버 핵심 프로그램
# bind9utils: DNS 서버 관리를 위한 유틸리티 도구 (named-checkconf 등)
# bind9-doc: BIND9 관련 상세 매뉴얼 및 문서
# -y: 설치 과정 중 나타나는 모든 확인 질문에 자동으로 'yes'라고 응답합니다.
sudo apt install bind9 bind9utils bind9-doc -y

```

> **Cost Alert:** BIND9 소프트웨어 라이선스는 **무료(Open Source)**입니다. 하지만 AWS 환경에서 **EC2 인스턴스**를 생성하여 해당 서버를 가동할 경우, 인스턴스 타입 및 가동 시간에 따른 **EC2 컴퓨팅 비용**과 데이터 전송량에 따른 **Network Out 비용**이 발생하므로 주의가 필요합니다.

---

## 전역 설정 구성 (`named.conf.options`)

서버의 보안 정책, 접근 제어(ACL), 그리고 자체적으로 해결할 수 없는 도메인 질의를 전달할 포워더를 설정합니다.

```bash
# 텍스트 에디터인 nano를 사용하여 BIND9의 전역 옵션 설정 파일을 엽니다.
sudo nano /etc/bind/named.conf.options

```

**설정 파일 상세 내용:**

```bind
// 접근 제어 목록(ACL) 정의: DNS 질의를 허용할 네트워크 범위를 'trusted'라는 이름으로 그룹화합니다.
acl "trusted" {
        127.0.0.0/8;      // 서버 자기 자신(localhost)으로부터의 질의 허용
        192.168.1.0/24;   // 내부 사설 네트워크 대역(192.168.1.1 ~ 192.168.1.254)의 질의 허용
};

options {
        // DNS 캐시 데이터 및 작업 파일이 저장될 기본 디렉터리를 지정합니다.
        directory "/var/cache/bind";

        // 재귀적 질의(내부 사용자가 외부 도메인을 물어볼 때 끝까지 찾아주는 기능) 허용 여부
        recursion yes;
        
        // 위에서 정의한 'trusted' ACL에 포함된 IP들만 이 서버에 질의를 보낼 수 있도록 제한합니다.
        allow-query { trusted; };

        // 이 서버가 직접 관리하지 않는 도메인(예: google.com)에 대한 질의를 전달할 상위 DNS 서버 주소입니다.
        forwarders {
                8.8.8.8;  // Google Public DNS 1
                8.8.4.4;  // Google Public DNS 2
        };

        // DNSSEC(DNS 보안 확장) 응답의 유효성을 자동으로 검증하도록 설정합니다.
        dnssec-validation auto;
        
        // IPv6 주소를 통한 질의에 대해 모든 인터페이스에서 대기(Listen)하도록 설정합니다.
        listen-on-v6 { any; };
};

```

---

## 로컬 존 선언 (`named.conf.local`)

서버가 직접 권한을 가지고 응답할 도메인 영역(Zone)을 정의합니다.

```bash
# 로컬 영역 설정을 관리하는 파일을 편집합니다.
sudo nano /etc/bind/named.conf.local

```

**설정 파일 상세 내용:**

```bind
// 정방향 조회(Forward Lookup): 도메인 이름을 IP 주소로 변환하기 위한 영역 설정
zone "devops.local" {
    type master;                         // 이 서버가 해당 도메인의 주 서버(Primary)임을 선언
    file "/etc/bind/db.devops.local";    // 실제 도메인 레코드 정보가 저장된 파일 경로
};

// 역방향 조회(Reverse Lookup): IP 주소를 도메인 이름으로 변환하기 위한 영역 설정
// 192.168.1.x 대역의 경우 옥텟(Octet) 순서를 거꾸로 배치하고 .in-addr.arpa를 붙입니다.
zone "1.168.192.in-addr.arpa" {
    type master;                         // 역방향 조회에 대해서도 주 서버 역할을 수행
    file "/etc/bind/db.192";             // 역방향 레코드 정보가 저장될 파일 경로
};

```

---

## 정방향 존 파일 생성 및 레코드 작성

실제 도메인 이름들이 어떤 IP를 가리키는지 상세 데이터를 입력합니다.

```bash
# 기본 제공되는 템플릿 파일(db.local)을 복사하여 관리할 도메인용 파일을 생성합니다.
sudo cp /etc/bind/db.local /etc/bind/db.devops.local

# 생성한 존 파일을 편집기로 엽니다.
sudo nano /etc/bind/db.devops.local

```

**파일 내부 주석 및 레코드 구성:**

```bind
;
; BIND 데이터 파일: devops.local 도메인용
;
$TTL    604800          ; Time To Live: 다른 서버가 이 정보를 캐시에 유지할 기본 시간 (초 단위, 여기선 1주일)

; SOA(Start of Authority): 권한 시작 레코드. 이 존 파일의 관리 정보를 담고 있습니다.
; @는 현재 존(devops.local)을 의미하며, ns1.devops.local.은 이 도메인의 주 네임 서버입니다.
; admin.devops.local.은 관리자 이메일 주소(admin@devops.local)를 의미합니다.
@       IN      SOA     ns1.devops.local. admin.devops.local. (
                              2         ; Serial: 파일 수정 시 숫자를 높여야 변경 사항이 전파됨
                         604800         ; Refresh: 보조 서버가 주 서버의 데이터를 갱신 확인하는 주기
                          86400         ; Retry: 갱신 실패 시 재시도 간격
                        2419200         ; Expire: 주 서버 응답 없을 시 보조 서버가 데이터를 폐기하기 전 대기 시간
                         604800 )       ; Negative Cache TTL: 정보가 없는 도메인에 대한 응답 캐시 시간

; NS(Name Server) 레코드: 이 도메인을 담당하는 네임 서버의 이름을 지정합니다.
@       IN      NS      ns1.devops.local.

; A(Address) 레코드: 호스트 이름을 IPv4 주소로 매핑합니다.
@       IN      A       192.168.1.10    ; devops.local (루트 도메인) 자체의 IP 주소
ns1     IN      A       192.168.1.10    ; ns1.devops.local의 IP (이 서버 자신)
www     IN      A       192.168.1.20    ; www.devops.local 웹 서버의 IP 주소
db      IN      A       192.168.1.30    ; db.devops.local 데이터베이스 서버의 IP 주소

```

---

## 설정 검증 및 서비스 운영

파일을 수정한 후에는 서비스에 적용하기 전 문법적 오류가 없는지 반드시 확인해야 합니다.

```bash
# 1. 메인 설정 파일(named.conf*)의 구문 오류를 검사합니다. (오류가 없으면 아무 내용도 출력되지 않음)
sudo named-checkconf

# 2. 특정 존 파일의 데이터 무결성을 검사합니다. (명령어: named-checkzone [도메인명] [파일경로])
sudo named-checkzone devops.local /etc/bind/db.devops.local

# 3. 설정에 문제가 없다면 BIND9 서비스를 재시작하여 변경 사항을 실시간으로 반영합니다.
sudo systemctl restart bind9

# 4. 서비스가 오류 없이 'active (running)' 상태인지 현재 동작 현황을 확인합니다.
sudo systemctl status bind9

```

---

## 보안 설정 및 질의 테스트

방화벽을 개방하고 외부 혹은 로컬에서 도메인이 정상적으로 풀이되는지 확인합니다.

```bash
# DNS 통신에 필요한 53번 포트(UDP 및 TCP)를 방화벽(UFW)에서 허용합니다.
sudo ufw allow Bind9

# nslookup 도구를 사용하여 특정 네임서버(127.0.0.1)를 대상으로 도메인 조회를 수행합니다.
# 형식: nslookup [찾을 도메인] [질의를 보낼 DNS 서버 주소]
nslookup www.devops.local 127.0.0.1

```

---

Next Step: BIND9 역방향 조회(Reverse Zone) 설정 및 DNS 레코드 타입(CNAME, MX, TXT) 상세 분석
