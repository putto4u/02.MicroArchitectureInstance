AWS **EC2 Ubuntu 인스턴스**에 **MariaDB**를 구축하는 절차를 IT 전문가의 관점에서 실전 팁과 함께 상세하게 안내해 드리겠습니다. MariaDB는 MySQL의 강력한 대안으로, 높은 호환성과 성능을 제공합니다.

-----

## 1\. AWS EC2 인스턴스 준비 및 접속

MySQL 구축과 마찬가지로, 먼저 MariaDB 서버를 설치할 환경을 준비합니다.

### 1.1. EC2 인스턴스 및 보안 그룹 설정

**AWS 콘솔**에서 **Ubuntu Server** 최신 버전을 선택하여 EC2 인스턴스를 생성합니다.

  * **⚠️ 실전 팁: 보안 그룹 설정 (MariaDB 포트 개방)**
      * **SSH (Port 22)**: 접속을 위해 필요한 IP로 설정합니다.
      * **MariaDB/MySQL (Port 3306)**: MariaDB는 MySQL과 동일하게 **3306 포트**를 기본적으로 사용합니다. 외부 접속을 허용하려면 **이 포트를 개방**해야 합니다. 반드시 접속할 클라이언트 IP 주소 또는 서비스 IP 범위로 제한하여 **보안을 강화**해야 합니다.

### 1.2. 인스턴스 접속

생성된 인스턴스의 **퍼블릭 IP**와 **Key Pair**를 사용하여 SSH로 접속합니다.

```bash
ssh -i /path/to/your/key.pem ubuntu@<EC2 퍼블릭 IP>
```

-----

## 2\. MariaDB 설치 및 초기 설정

Ubuntu 환경에서 MariaDB를 설치하고 초기 보안 설정을 진행합니다.

### 2.1. 패키지 업데이트 및 MariaDB 설치

시스템 패키지 목록을 업데이트하고 MariaDB 서버 패키지를 설치합니다.

```bash
# 패키지 목록 업데이트
sudo apt update

# MariaDB 서버 설치 (Ubuntu 저장소 기본)
sudo apt install mariadb-server -y
```

### 2.2. MariaDB 서비스 확인

설치 완료 후, MariaDB 서비스가 정상적으로 실행 중인지 확인합니다.

```bash
sudo systemctl status mariadb
```

*(출력 결과에서 `active (running)`을 확인)*

### 2.3. MariaDB 보안 설정 (`mysql_secure_installation`)

설치 직후 **데이터베이스 보안을 강화**하기 위해 필수적인 스크립트를 실행합니다. MariaDB에서도 MySQL과 동일한 스크립트를 사용합니다.

```bash
sudo mysql_secure_installation
```

  * **실행 시 주요 설정 내용:**
      * **Root Password 설정**: 루트 사용자의 비밀번호 설정
      * **Remove anonymous users?**: 익명 사용자 제거 (✅ Yes)
      * **Disallow root login remotely?**: 원격 root 접속 차단 (✅ Yes 권장)
      * **Remove test database and access to it?**: 테스트 DB 제거 (✅ Yes)
      * **Reload privilege tables now?**: 권한 테이블 새로고침 (✅ Yes)

-----

## 3\. 원격 접속을 위한 설정 (필요 시)

기본 설정은 로컬 접속만 허용합니다. 외부에서 접속하려면 설정을 변경해야 합니다.

### 3.1. 바인드 주소 (Bind Address) 변경

MariaDB 설정 파일(`50-server.cnf` 또는 `mariadb.conf.d/50-server.cnf`)을 수정하여 외부 접속을 허용합니다.

```bash
# MariaDB 설정 파일 위치는 환경에 따라 다를 수 있습니다.
sudo nano /etc/mysql/mariadb.conf.d/50-server.cnf
```

파일 내에서 `bind-address` 항목을 찾아 아래와 같이 수정합니다.

```ini
# 주석 처리 또는 127.0.0.1 대신 0.0.0.0으로 변경
# bind-address            = 127.0.0.1
bind-address            = 0.0.0.0
```

  * **💡 실전 팁**: 보안을 위해 `0.0.0.0` 대신 **특정 IP 주소**(`192.168.x.x` 등)로 설정하여 접속 가능한 대상을 명확히 제한하는 것이 가장 좋습니다.

변경 후, MariaDB 서비스를 재시작합니다.

```bash
sudo systemctl restart mariadb
```

### 3.2. 원격 접속용 사용자 계정 생성 및 권한 부여

보안상 root 계정은 원격 접속용으로 사용하지 않고, 별도의 일반 사용자를 생성합니다.

MariaDB 쉘에 접속합니다.

```bash
sudo mariadb -u root -p
```

*(앞서 설정한 root 비밀번호 입력)*

```sql
-- 새로운 사용자 생성 및 모든 IP에서 접속 허용 (%)
CREATE USER 'dev_user'@'%' IDENTIFIED BY 'YourSecurePassword@123!';

-- 'production_db' 데이터베이스에 dev_user에게 모든 권한 부여
GRANT ALL PRIVILEGES ON production_db.* TO 'dev_user'@'%';

-- 권한 테이블 새로고침 적용
FLUSH PRIVILEGES;

-- 쉘 종료
EXIT;
```

-----

## 4\. 최종 점검 및 보안 강화

### 4.1. 사용자 인증 방식 확인 (Ubuntu 20.04+ 이슈)

Ubuntu 최신 버전에서는 MariaDB 루트 사용자가 기본적으로 `unix_socket` 인증 방식을 사용할 수 있습니다. 이 경우 \*\*`mysql_secure_installation`\*\*을 통해 비밀번호를 설정했더라도 **SSH를 통해 접속한 Ubuntu 사용자**로 `sudo mariadb`를 입력하면 비밀번호 없이 접속될 수 있습니다.

  * **해결 방법**: 앞서 `mysql_secure_installation`을 완료했다면, SSH에서 `sudo mariadb -u root -p`로 접속하여 비밀번호를 사용하여 접속을 시도해보세요. 만약 이 방법으로 접속이 안되고 비밀번호 없이 `sudo mariadb`로만 접속된다면, 다음 명령어로 인증 방식을 변경할 수 있습니다.

<!-- end list -->

```sql
-- MariaDB 쉘 내부에서 실행
ALTER USER 'root'@'localhost' IDENTIFIED VIA mysql_native_password USING PASSWORD('NewRootPassword!');
FLUSH PRIVILEGES;
```

### 4.2. 📌 핵심 보안 점검

| 점검 사항 | 내용 | 중요도 |
| :--- | :--- | :--- |
| **AWS 보안 그룹** | 3306 포트가 **필요한 IP**만 허용하는지 재확인 (방화벽 역할) | **최상** |
| **MariaDB Bind Address** | `0.0.0.0`으로 설정 시, **AWS 보안 그룹**으로 외부 접근을 철저히 막았는지 확인 | 높음 |
| **사용자 권한** | 일반 사용자가 **필요한 데이터베이스**에만 권한을 가졌는지 확인 | 높음 |
| **백업 전략** | 구축 후, **자동 백업** 및 **복구 전략**을 수립했는지 확인 | **최상** |

이 절차를 통해 AWS Ubuntu 환경에 안정적이고 안전한 MariaDB 서버 구축을 완료할 수 있습니다. 
