# 로컬 환경에서 SSH 키 생성 및 AWS 키 페어 가져오기 (Import Key Pair)

사용자가 이해한 내용이 정확합니다. 보안 모범 사례에 따르면, 클라우드 공급자가 키를 생성하게 하여 다운로드하는 것보다 **사용자의 PC(로컬)에서 키 쌍을 직접 생성한 후, '공개 키(Public Key)'만 AWS에 등록**하는 방식이 더 안전하고 권장됩니다. 이 방식을 사용하면 개인 키(Private Key)가 네트워크를 타고 전송되지 않으며, 단 한 번도 클라우드 외부로 노출되지 않습니다.

이 과정을 **'키 페어 가져오기(Import Key Pair)'**라고 하며, 절차는 아래와 같습니다.

---

### 1. 1단계: 로컬 PC에서 SSH 키 쌍 생성

AWS가 아닌, 내 컴퓨터(Windows/Linux/Mac)에서 직접 키를 생성합니다.

#### A. Linux / Mac / Windows(PowerShell) 공통

최신 Windows 10/11은 OpenSSH 클라이언트가 내장되어 있어 Linux와 동일한 명령어를 사용할 수 있습니다.

```bash
# 1. .ssh 디렉토리로 이동 (없으면 생성)
mkdir -p ~/.ssh
cd ~/.ssh

# 2. 키 생성 명령어 실행
# -t rsa: 암호화 방식
# -b 4096: 키 길이 (보안 강도, 4096 권장)
# -f my-local-key: 파일 이름 지정
ssh-keygen -t rsa -b 4096 -f my-local-key

```

* **Passphrase:** 엔터키를 두 번 눌러 생략(Empty)하거나, 보안을 위해 암호를 설정합니다.
* **결과 확인:** 두 개의 파일이 생성됩니다.
* `my-local-key` (개인 키): **절대 타인에게 공유 금지.** 내 PC에만 보관.
* `my-local-key.pub` (공개 키): **AWS에 업로드할 파일.**

**일반 다른 서버(내 버춸박스 내 VM서버 등)에 공개키 전송 및 등록할 때**
```cmd
# 형식: type [공개키경로] | ssh [계정]@[IP] "cat >> .ssh/authorized_keys"
type $env:USERPROFILE\.ssh\my-local-key.pub | ssh master@192.168.219.102 "mkdir -p .ssh && cat >> .ssh/authorized_keys"
```



---

### 2. 2단계: AWS에 공개 키 등록 (Import)

생성된 `.pub` 파일의 내용을 AWS에 등록하여, AWS가 이 키를 인식하도록 만듭니다.

#### 방법 A: AWS 관리 콘솔 (GUI) 사용 시

1. **EC2 대시보드** > **네트워크 및 보안** > **키 페어** 메뉴로 이동합니다.
2. 우측 상단의 **[작업]** > **[키 페어 가져오기(Import key pair)]**를 클릭합니다.
3. **이름:** `My-Local-Imported-Key` (원하는 이름)
4. **키 파일 찾아보기**를 누르거나, `my-local-key.pub` 파일을 메모장으로 열어 내용을 복사해 붙여넣습니다.
5. **[키 페어 가져오기]** 버튼 클릭.

#### 방법 B: AWS CLI 사용 시

CLI를 이용해 한 줄로 등록할 수도 있습니다.

**[Linux / Mac]**

```bash
aws ec2 import-key-pair \
    --key-name My-Local-Imported-Key \
    --public-key-material fileb://~/.ssh/my-local-key.pub

```

**[Windows PowerShell]**

```powershell
# 파일 내용을 읽어서 변수에 저장 후 전송
$pubKey = Get-Content -Path $env:USERPROFILE\.ssh\my-local-key.pub -Raw
aws ec2 import-key-pair `
    --key-name My-Local-Imported-Key `
    --public-key-material $pubKey

```

---

### 3. 3단계: 인스턴스 생성 시 적용

이제 인스턴스를 만들 때, 방금 등록한 키 이름을 선택하면 됩니다.

* **콘솔:** 인스턴스 시작 화면의 키 페어 선택 목록에 `My-Local-Imported-Key`가 나타납니다.
* **CLI:** `--key-name My-Local-Imported-Key` 옵션을 사용합니다.

---

### 4. AWS 생성 방식 vs 사용자 생성(Import) 방식 비교

| 비교 항목 | AWS 생성 방식 (Create Key Pair) | 사용자 생성 방식 (Import Key Pair) |
| --- | --- | --- |
| **개인 키 위치** | AWS에서 생성 후 1회 다운로드 제공 | 생성부터 보관까지 사용자 PC에만 존재 |
| **보안성** | 다운로드 과정에서 네트워크 전송 발생 (SSL로 보호되나 이론적 위험 존재) | **최상 (Private Key가 외부로 나가지 않음)** |
| **분실 시** | 파일 삭제 시 복구 불가능 | 원본이 내 PC에 있으므로 다시 등록 가능 |
| **멀티 클라우드** | `.pem`을 변환하거나 공개 키를 추출해야 함 | **동일한 공개 키를 AWS, Azure, GCP에 모두 등록하여 즉시 통일 가능** |
| **추천 대상** | 초심자, 임시 테스트 | **엔지니어, 운영 환경, 멀티 클라우드 사용자** |

Next Step: 생성한 EC2 인스턴스에 SSH 클라이언트(터미널)로 직접 접속하는 방법 (Windows/Mac)

---
# SSH 개인 키(Private Key)의 안전한 휴대 및 관리 전략

결론부터 말씀드리면 **"개인 키(Private Key)는 절대 GitHub에 올리면 안 됩니다."**

GitHub는 `Private Repository`라 할지라도 실수로 `Public`으로 전환되거나 계정이 해킹될 위험이 있으며, 해커들은 봇(Bot)을 통해 깃허브에 올라온 키 패턴(`-----BEGIN RSA PRIVATE KEY-----`)을 실시간으로 스캔합니다. 키가 노출되는 즉시 서버는 채굴기나 공격 경유지로 악용됩니다.

서로 다른 장소(집, 회사, 노트북 등)에서 서버에 접속해야 할 때, **키를 들고 다니는 것보다 더 안전하고 권장되는 방법(Multi-Key Strategy)**이 있습니다.

---

### 1. 최선의 방법: 장치별 '전용 키' 생성 (Multi-Key Strategy)

가장 안전하고 전문적인 방법은 **"키를 복사해서 들고 다니는 것"이 아니라, "각 장소마다 별도의 키를 만드는 것"**입니다.

마치 현관문(서버) 자물쇠를 바꿀 필요 없이, 가족 구성원(내 PC들)에게 복제된 열쇠가 아닌 **각자의 열쇠**를 등록해 주는 원리입니다.

#### 구성 절차

1. **집 PC:** `Home-Key` 생성 -> `Home-Key.pub` (공개 키) 추출
2. **회사 PC:** `Office-Key` 생성 -> `Office-Key.pub` (공개 키) 추출
3. **서버 설정:** AWS 인스턴스 내의 `~/.ssh/authorized_keys` 파일에 두 공개 키를 모두 등록합니다.

#### 등록 예시 (서버 내부 파일)

서버의 `~/.ssh/authorized_keys` 파일을 열어보면 아래와 같이 여러 줄로 키를 추가할 수 있습니다.

```text
# ~/.ssh/authorized_keys
ssh-rsa AAAAB3... (생략) ... my-home-pc   <-- 집 PC용 공개 키
ssh-rsa AAAAB3... (생략) ... my-office-pc <-- 회사 PC용 공개 키

```

#### 장점

* **보안성 최상:** 개인 키 파일이 네트워크를 타거나 USB에 담길 일이 없습니다.
* **유연한 관리:** 만약 회사 노트북을 잃어버렸다면, 서버에서 `Office-Key` 한 줄만 지우면 됩니다. 집 PC의 접속 권한은 그대로 유지됩니다.

---

### 2. 차선의 방법: 물리적 휴대 (USB)

키를 여러 개 관리하기 번거로워 부득이하게 하나의 키를 가지고 다녀야 한다면, 인터넷(클라우드, 이메일, 메신저)을 통하지 않는 **물리적 매체**가 가장 안전합니다.

* **방법:** 보안 USB 드라이브에 `.pem` 파일을 담아 가지고 다닙니다.
* **주의:** USB 분실 시 즉시 해당 키를 서버에서 폐기(교체)해야 합니다.

---

### 3. 클라우드 저장 시 필수 보안 수칙 (암호화)

USB 휴대가 불가능하여 Google Drive, Dropbox, iCloud 등을 사용해야 한다면, **절대로 원본 파일(`.pem`) 그대로 업로드해서는 안 됩니다.**

#### 안전한 클라우드 저장 방법

1. **압축 암호화:**
* 압축 프로그램(7-Zip, Bandizip 등)을 사용하여 `.pem` 파일을 압축하되, 반드시 **AES-256** 암호화 옵션을 켜고 **복잡한 비밀번호**를 겁니다.
* 이 압축 파일(`.zip`, `.7z`) 상태로 클라우드에 올립니다.


2. **패스워드 매니저 사용 (추천):**
* 1Password, LastPass, Bitwarden 같은 전문 암호 관리 프로그램은 **'보안 메모'**나 **'파일 첨부'** 기능을 제공합니다.
* 이들은 강력하게 암호화되어 클라우드에 동기화되므로 비교적 안전합니다.



---

### 4. 시나리오별 보안 위험도 비교표

| 저장/이동 방법 | 위험도 | 평가 및 권장 여부 |
| --- | --- | --- |
| **GitHub (Public)** | ☢️ **치명적** | **절대 금지.** 올리는 즉시 수초 내에 봇이 감지하여 서버 해킹됨. |
| **GitHub (Private)** | ❌ **위험** | 계정 탈취 시 유출 위험. 실수로 Public 전환 시 유출. 권장하지 않음. |
| **카카오톡/슬랙** | ❌ **위험** | 메신저 서버에 파일이 남으며, 로그인을 통해 쉽게 다운로드 가능함. |
| **USB 드라이브** | ⚠️ **보통** | 분실 위험만 주의하면 네트워크 해킹으로부터 안전함. |
| **암호화된 클라우드** | ✅ **양호** | 압축 암호(AES-256)를 걸었다면 현실적으로 안전함. |
| **장치별 키 생성** | ⭐ **최상** | **가장 권장하는 방식.** 개인 키 자체를 이동시키지 않음. |

---

### 5. (참고) 실수로 GitHub에 키를 올렸다면?

만약 실수로 1초라도 키가 공개되었다면, 그 키는 **"이미 복제되었다"**고 간주해야 합니다.

1. **즉시 해당 키 폐기:** GitHub에서 파일 삭제로는 부족합니다. (히스토리에 남음)
2. **서버 접속 권한 제거:** 서버의 `authorized_keys`에서 해당 공개 키 삭제.
3. **AWS 키 페어 삭제:** AWS 콘솔에서 해당 키 페어 삭제.
4. **새 키 생성 및 교체:** 새로운 키를 만들어 다시 등록해야 합니다.

Next Step: 생성한 EC2 인스턴스에 SSH 클라이언트(터미널)로 직접 접속하는 방법 (Windows/Mac)
