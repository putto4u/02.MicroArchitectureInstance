## 하이브리드·멀티 클라우드 및 IaC를 위한 초기 표준화 전략

AWS, Azure, GCP, 그리고 온프레미스(IDC)를 아우르는 하이브리드 멀티 클라우드 환경을 구축할 때, 가장 치명적인 위험은 **'파편화(Fragmentation)'**입니다. 클라우드마다 다른 기준을 적용하면 IaC(Terraform, Ansible) 코드의 복잡도가 기하급수적으로 증가하여 유지보수가 불가능해집니다.

성공적인 IaC 및 자동화를 위해 프로젝트 초기에 반드시 확정해야 할 **'불변의 법칙(Standard Governance)'**을 정의합니다.

---

### 1. OS 및 시스템 환경 표준화 (OS Governance)

IaC 스크립트(Ansible Playbook 등)가 `if (os == aws) ... else if (os == azure)`와 같은 분기문 없이 하나의 코드로 동작하려면 OS 환경을 일치시켜야 합니다.

#### 1.1 OS 종류 및 버전 단일화

CSP(Cloud Service Provider)가 제공하는 기본 이미지를 그대로 쓰지 않고, **'Golden Image'** 전략을 사용합니다.

* **권장 OS:** **Ubuntu Server LTS (Long Term Support)**
* *이유:* 모든 클라우드 및 온프레미스에서 가장 호환성이 높고 패키지명이 동일함.


* **버전 고정:** **Ubuntu 24.04 LTS** (또는 22.04 LTS)
* 모든 클라우드에서 동일한 메이저 버전을 사용해야 커널 버전, 라이브러리 의존성(Python, OpenSSL 등) 문제를 예방할 수 있습니다.



#### 1.2 시스템 계정(User) 통합

클라우드마다 기본 접속 계정이 다릅니다(AWS: `ec2-user`, Azure: `azureuser`, GCP: 사용자계정). 이를 그대로 두면 자동화 스크립트 작성 시 매우 번거롭습니다.

* **전략:** `Cloud-init`을 이용하여 인스턴스 생성 시점에 **공통 관리자 계정**을 자동 생성합니다.
* **표준 계정명 예시:** `devops-admin` 또는 `ubuntu` (단일화 필수)
* **보안 설정:** 모든 서버의 해당 계정에 동일한 **공개키(Public Key)**를 주입하여, 하나의 개인키(Private Key)로 모든 클라우드 서버에 접속 가능하도록 구성합니다.

---

### 2. 리소스 명명 규칙 (Naming Convention)

리소스의 이름만 보고도 '어디에 있는, 어떤 용도의, 누가 만든' 자원인지 파악할 수 있어야 합니다. 이는 Terraform의 `Filter` 기능이나 Ansible의 `Inventory` 구성 시 핵심 키(Key)가 됩니다.

#### 2.1 기본 패턴

**`[CSP/위치]-[환경]-[서비스]-[역할]-[번호]`**

| 구분 | 설명 | 코드 예시 | 비고 |
| --- | --- | --- | --- |
| **위치** | 리전 또는 클라우드 식별자 | `aws`, `azr`, `gcp`, `idc` | 3글자 단축 권장 |
| **환경** | 운영 단계 | `prd`(운영), `stg`(검증), `dev`(개발) | `prod` 대신 3글자 통일 |
| **서비스** | 프로젝트/서비스명 | `shop`, `pay`, `data` | 비즈니스 단위 |
| **역할** | 리소스의 기능 | `web`, `was`, `db`, `lb`, `vpc` | 기술적 역할 |
| **번호** | 중복 방지 순번 | `001`, `002` | 3자리 숫자 패딩 |

#### 2.2 적용 예시

* **AWS의 서울 리전, 쇼핑몰 운영환경의 첫 번째 웹 서버:**
* `aws-prd-shop-web-001`


* **IDC의 개발환경 결제 DB 서버:**
* `idc-dev-pay-db-001`



> **IaC 적용 효과:** Terraform에서 *"이름에 `prd-shop-web`이 포함된 모든 리소스"*를 검색하여 로드밸런서에 자동 연결하는 로직 구현이 가능해집니다.

---

### 3. 네트워크 주소 설계 (Network CIDR Strategy)

멀티 클라우드 연결(VPN, Direct Connect) 시 가장 빈번하게 발생하는 **IP 주소 충돌**을 막기 위해 전사적인 IP 할당 계획(IPAM)이 선행되어야 합니다.

#### 3.1 대역 분리 원칙 (Non-overlapping CIDR)

각 클라우드와 온프레미스에 겹치지 않는 사설 IP 대역을 미리 할당합니다. `10.0.0.0/16`을 모든 곳에 기본값으로 쓰면 나중에 절대 연결할 수 없습니다.

| 위치 | 할당 대역 (예시) | 용도 |
| --- | --- | --- |
| **On-Premise (IDC)** | `10.0.0.0/16` ~ `10.9.0.0/16` | 기존 레거시 시스템 및 사내망 |
| **AWS (Seoul)** | `10.10.0.0/16` | 메인 클라우드 서비스 |
| **AWS (Virginia)** | `10.11.0.0/16` | DR(재해복구) 또는 글로벌 서비스 |
| **Azure** | `10.20.0.0/16` | 특정 SaaS 연동 또는 MS SQL 워크로드 |
| **GCP** | `10.30.0.0/16` | 데이터 분석 및 AI 워크로드 |
| **Docker/K8s** | `172.16.0.0/12` | 컨테이너 내부 통신용 (Node IP와 분리) |

---

### 4. 태깅 전략 (Tagging Governance)

리소스 이름에 담을 수 없는 메타데이터는 태그(Tag)로 관리합니다. 특히 비용 정산(Bill)과 자동화 관리를 위해 **필수 태그(Mandatory Tags)**를 정의하고, 미준수 시 리소스 생성을 차단해야 합니다.

| 태그 키 (Key) | 값 (Value) 예시 | 용도 |
| --- | --- | --- |
| **`Environment`** | `Production`, `Develop` | 운영/개발 리소스 필터링 및 접근 제어 |
| **`Project`** | `ShoppingMall`, `BigData` | 프로젝트별 비용(Cost) 분리 |
| **`Owner`** | `InfraTeam`, `DevTeam-A` | 담당 부서 식별 (장애 발생 시 연락처) |
| **`ManagedBy`** | `Terraform`, `Console` | **IaC 관리 여부 식별 (중요)** |
| **`ExpiryDate`** | `2025-12-31` | 임시 리소스의 자동 삭제 스케줄링용 |

---

### 5. 도구 및 버전 통일 (Toolchain Standardization)

IaC 도구 자체의 버전 차이로 인한 오류를 방지합니다.

* **Terraform 버전 고정:** 팀원 간 `terraform.tf` 파일 내에 `required_version`을 명시하여 특정 버전(예: `v1.9.0`) 이상에서만 실행되도록 강제합니다. (`tfenv` 도구 사용 권장)
* **Provider 버전 고정:** AWS, Azure 플러그인(Provider)의 버전 업데이트로 문법이 바뀌는 것을 막기 위해 버전을 고정(Pinning)합니다.
* **Secret 관리:** `.pem` 키나 DB 패스워드는 절대 코드에 넣지 않고, **AWS Secrets Manager**나 **HashiCorp Vault**와 같은 외부 저장소를 참조하도록 통일합니다.

---

Next Step: Windows 및 Mac 환경에서 SSH(Secure Shell) 클라이언트를 이용하여 생성한 EC2 인스턴스에 원격 접속하기
