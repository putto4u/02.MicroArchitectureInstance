## EC2 웹 서버 외부 접속 실패 원인 및 해결 (보안 그룹과 네트워크)



EC2 인스턴스를 생성하고 Nginx를 설치했다고 해서 인터넷(외부)에서 바로 접속할 수 있는 것은 아닙니다. AWS는 기본적으로 **'모든 외부 접속을 차단(Deny All)'**하는 보안 정책을 가지고 있기 때문입니다. 외부에서 내 웹 서버(Nginx) 화면을 보기 위해서는 AWS가 쳐놓은 **3가지의 방어막**을 통과해야 합니다.

---

### 1. 첫 번째 방어막: 보안 그룹 (Security Group) - 가장 흔한 원인

AWS의 가장 기초적이고 강력한 방화벽입니다. EC2 인스턴스 생성 시 기본적으로 할당되는 보안 그룹의 규칙은 다음과 같습니다.

* **기본 설정:** 아웃바운드(나가는 것)는 모두 허용, **인바운드(들어오는 것)는 모두 차단** (또는 SSH 22번 포트만 허용).
* **문제점:** 웹 브라우저가 사용하는 **HTTP(80)** 또는 **HTTPS(443)** 포트가 닫혀 있어 접속 요청이 EC2에 도달조차 못하고 AWS 네트워크 단에서 거절당합니다.

#### **해결 방법**

해당 EC2에 연결된 보안 그룹의 **인바운드 규칙(Inbound Rules)**을 수정해야 합니다.

1. EC2 콘솔 > 인스턴스 선택 > 하단 **[보안(Security)]** 탭 > **보안 그룹 링크** 클릭.
2. **[인바운드 규칙 편집]** 클릭.
3. **규칙 추가:**
* **유형:** HTTP
* **프로토콜:** TCP
* **포트 범위:** 80
* **소스:** `0.0.0.0/0` (전 세계 어디서든 접속 허용) 또는 `내 IP` (나만 접속 허용).



---

### 2. 두 번째 방어막: 공인 IP (Public IP) 주소

우리가 PC방이나 회사 내부망에서 쓰는 `192.168.x.x`나 `10.x.x.x`와 같은 IP는 **사설 IP(Private IP)**입니다. 이 주소로는 외부 인터넷에서 찾아갈 수 없습니다.

* **문제점:** EC2 생성 시 "퍼블릭 IP 자동 할당" 옵션을 끄고 만들었다면, 해당 서버는 인터넷 주소가 없는 상태이므로 외부에서 접근이 불가능합니다.
* **확인 방법:** EC2 콘솔의 인스턴스 요약 화면에서 **`퍼블릭 IPv4 주소`** 값이 있는지 확인합니다.

#### **해결 방법**

* **생성 시:** `네트워크 설정`에서 **[퍼블릭 IP 자동 할당: 활성화]**를 선택해야 합니다.
* **생성 후:** 이미 만들어진 인스턴스에 공인 IP를 나중에 붙이려면 **탄력적 IP (Elastic IP)**를 별도로 발급받아 연결해야 합니다. (※ 탄력적 IP는 연결하지 않고 방치하면 과금됩니다.)

---

### 3. 세 번째 방어막: 인터넷 게이트웨이 (Internet Gateway)

EC2가 위치한 네트워크(VPC)가 인터넷과 물리적으로 연결되어 있는지를 결정합니다.

* **문제점:** EC2가 위치한 서브넷(Subnet)이 인터넷 게이트웨이(IGW)와 연결되지 않은 **'프라이빗 서브넷(Private Subnet)'**이라면, 공인 IP가 있어도 통신이 불가능합니다.
* **참고:** AWS 계정 생성 시 기본으로 제공되는 **'기본 VPC(Default VPC)'**를 사용했다면 이 부분은 자동으로 설정되어 있습니다.

---

### 4. 네 번째 방어막: OS 내부 방화벽 (Linux Firewall)

AWS 방화벽(보안 그룹)을 통과했더라도, EC2 리눅스 내부의 방화벽이 막고 있을 수 있습니다.

* **문제점:** Ubuntu의 `ufw`나 CentOS/RHEL의 `firewalld`가 80번 포트를 차단 중일 수 있습니다. (Amazon Linux 2023 등 최신 AMI는 기본적으로 열려있는 경우가 많으나 확인이 필요합니다.)

#### **해결 방법 (터미널 명령어)**

Nginx 설치 후 서비스가 정상적으로 떠 있는지 확인하고 내부 방화벽을 확인합니다.

```bash
# 1. Nginx 실행 상태 확인
systemctl status nginx

# 2. 포트 리스닝 확인 (80번 포트가 LISTEN 상태인지)
netstat -anp | grep 80

# 3. (필요 시) 내부 방화벽 끄기 테스트 (CentOS/RHEL 계열)
systemctl stop firewalld

```

---

### 요약: 외부 접속을 위한 필수 체크리스트

| 단계 | 확인 항목 | 올바른 설정 값 |
| --- | --- | --- |
| **1. 서비스** | Nginx 프로세스 | `Active (running)` 상태여야 함 |
| **2. 방화벽 (AWS)** | **보안 그룹 (Security Group)** | **Inbound TCP 80 (Source: 0.0.0.0/0) 허용 필수** |
| **3. 주소** | 퍼블릭 IP (Public IP) | 인스턴스에 퍼블릭 IP가 할당되어 있어야 함 |
| **4. 네트워크** | 인터넷 게이트웨이 (IGW) | VPC의 라우팅 테이블이 IGW를 가리켜야 함 (`0.0.0.0/0 -> igw-xxxx`) |

---

Next Step: AWS 네트워크의 핵심, VPC(Virtual Private Cloud)의 구조와 서브넷(Subnet) 개념
