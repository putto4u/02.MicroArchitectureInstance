## 골든 인스턴스(Golden Instance) 백업 및 복구 가이드

**골든 인스턴스**란 운영체제, 필요한 모든 소프트웨어 설정, 보안 패치 등이 완료되어 즉시 서비스에 투입 가능한 '표준 템플릿' 상태의 인스턴스를 의미합니다. 이를 백업하고 복구하는 과정은 클라우드 인프라 운영의 핵심입니다.

---

### 1. 골든 인스턴스 백업: AMI 생성

AWS에서는 인스턴스의 현재 상태를 **AMI(Amazon Machine Image)**로 저장하여 백업합니다.

1. **인스턴스 정제**: 백업 전 임시 파일, 로그, 히스토리(`~/.bash_history`) 등을 삭제하여 이미지를 최소화합니다.
2. **이미지 생성**: EC2 콘솔에서 대상 인스턴스 선택 > `작업` > `이미지 및 템플릿` > `이미지 생성`을 클릭합니다.
3. **재부팅 안 함 옵션**: 기본적으로 AMI 생성 시 인스턴스가 재부팅됩니다. 서비스 중단이 불가능하다면 '재부팅 안 함'을 체크하되, 데이터 무결성을 위해 가급적 중단 후 생성을 권장합니다.
4. **결과 확인**: 생성된 이미지는 EC2 메뉴의 `이미지` > `AMI` 탭에서 확인할 수 있습니다.

---

### 2. 골든 인스턴스 복구: 새 인스턴스 시작

백업된 AMI를 사용하여 동일한 환경의 서버를 여러 대 복구하거나 새로 생성할 수 있습니다.

1. **AMI 선택**: EC2 콘솔의 `AMI` 메뉴에서 생성해둔 골든 이미지를 선택하고 `AMI로 인스턴스 시작`을 클릭합니다.
2. **인스턴스 유형 및 설정**: 기존 인스턴스와 동일하거나 필요한 사양의 인스턴스 유형을 선택합니다.
3. **네트워크 및 보안 설정**: 복구 시점에 적합한 VPC, 서브넷, 보안 그룹을 다시 지정합니다.
4. **검증**: 인스턴스 실행 후 서비스가 정상적으로 동작하는지 확인합니다.

---

### 3. 비용 및 관리 주의사항

| 항목 | 상세 내용 | 과금 여부 |
| --- | --- | --- |
| **EBS 스냅샷 저장** | AMI는 EBS 스냅샷 형태로 저장되며 용량만큼 비용 발생 | **유료** (GB당 과금) |
| **프리티어 혜택** | EBS 스냅샷 저장 용량 총합 1GB까지 무료 제공 | 1GB 초과 시 **유료** |
| **이미지 삭제** | AMI만 '등록 취소'하면 비용이 계속 나감. 반드시 **연관된 스냅샷도 삭제**해야 함 | 관리 부주의 시 **과금 지속** |

---

### 4. 깃허브 관리를 위한 CLI 명령어

```bash
# 1. 실행 중인 인스턴스로부터 AMI 생성 (AWS CLI)
# --no-reboot 옵션을 넣으면 재부팅 없이 생성 시도
aws ec2 create-image \
    --instance-id i-1234567890abcdef0 \
    --name "MyGoldenInstance-$(date +%Y%m%d)" \
    --description "Web Server Golden Image" \
    --no-reboot

# 2. 생성된 AMI ID 확인
aws ec2 describe-images --owners self --query 'Images[*].{Name:Name,ID:ImageId}'

```

Next Step: 오토 스케일링(Auto Scaling)과 골든 이미지 연동 방법

설명드린 내용은 표준적인 AMI 백업/복구 절차이며, 1GB 초과 시 스토리지 비용이 발생할 수 있으니 테스트 후에는 불필요한 스냅샷을 꼭 삭제하시기 바랍니다.

---
## AMI 생성 및 삭제 시 과금 메커니즘

결론부터 말씀드리면, **생성 직후 바로 삭제하더라도 요금이 0원이 아닐 가능성이 높습니다.** AWS의 과금 체계는 초 단위나 분 단위로 계산되는 항목이 많지만, 스토리지 관련 서비스는 최소 과금 단위나 일할 계산 방식에 따라 아주 소액이라도 비용이 발생할 수 있습니다.

---

### 1. 왜 0원이 아닐 수 있는가?

AMI를 생성하고 복구한 뒤 바로 지워도 비용이 발생하는 이유는 다음과 같습니다.

* **최소 과금 단위**: EBS 스냅샷(AMI의 본체)은 저장된 용량과 기간에 비례해 과금됩니다. 생성된 순간부터 삭제된 순간까지의 시간이 기록되며, 월별 GB당 단가를 기준으로 사용한 시간만큼 계산됩니다.
* **데이터 요청(Request) 비용**: AMI를 생성하는 과정에서 발생하는 스토리지 API 호출 및 데이터 복사 요청 자체에 대한 비용이 미세하게 발생할 수 있습니다.
* **EBS 볼륨 비용**: 복구를 위해 AMI로부터 인스턴스를 생성하면, 인스턴스가 켜져 있는 동안 해당 EBS 볼륨의 사용료가 발생합니다. (인스턴스를 바로 종료하더라도 최소 1분 요금이 부과되는 경우가 많습니다.)

---

### 2. 비용을 최소화하는 올바른 삭제 순서

단순히 AMI만 지운다고 해서 비용이 멈추지 않습니다. 아래 순서를 지키지 않으면 '유령 비용'이 계속 나갈 수 있습니다.

1. **인스턴스 종료(Terminate)**: 복구 테스트가 끝난 인스턴스를 삭제합니다. (중지가 아닌 종료여야 볼륨이 삭제됩니다.)
2. **AMI 등록 취소(Deregister)**: 생성했던 골든 이미지를 목록에서 제거합니다.
3. **스냅샷 삭제(Delete Snapshot)**: **가장 중요한 단계입니다.** AMI를 등록 취소해도 실제 데이터인 스냅샷은 남습니다. 반드시 `EC2 > 스냅샷` 메뉴에서 해당 스냅샷을 직접 삭제해야 합니다.

---

### 3. 유료 전환 및 과금 주의사항 요약

| 항목 | 과금 발생 지점 | 주의사항 |
| --- | --- | --- |
| **EBS 스냅샷** | AMI의 실제 데이터 저장 | 1GB 프리티어 초과 시 즉시 과금 시작 |
| **인스턴스 실행** | 복구된 서버 가동 | t2.micro 등 프리티어 외 사양은 초당 과금 |
| **데이터 전송** | 리전 간 AMI 복제 시 | 다른 리전으로 이미지를 옮기면 전송료 발생 |

---

### 4. 실습용 클린업 (CLI)

생성한 자원을 한 번에 확실히 지워 요금을 방지하는 명령어입니다.

```bash
# 1. 인스턴스 종료 (인스턴스 ID 필요)
aws ec2 terminate-instances --instance-ids i-1234567890abcdef0

# 2. AMI 등록 취소 (AMI ID 필요)
aws ec2 deregister-image --image-id ami-0123456789abcdef0

# 3. 스냅샷 삭제 (스냅샷 ID 필요 - AMI 상세 정보에서 확인 가능)
aws ec2 delete-snapshot --snapshot-id snap-0123456789abcdef0

```

Next Step: AWS 예산(Budgets) 알람 설정을 통한 과금 방지 전략

0원에 수렴하게 관리할 수는 있지만, 시스템적으로 생성-복제-기록 과정이 포함되므로 소수점 단위의 금액($0.01 미만 등)은 발생할 수 있다는 점을 인지해야 합니다.

Next Step: AWS 예산 설정 및 결제 대시보드 활용법
