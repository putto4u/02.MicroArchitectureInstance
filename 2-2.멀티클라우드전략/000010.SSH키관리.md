## 실전 환경에서의 SSH 키 관리 및 접속 전략

질문하신 대로 인스턴스마다 별도의 `.pem` 키를 생성하는 것은 관리 불가능한 상황(Key Management Hell)을 초래합니다. 실무에서는 **'키 개수를 최소화'**하거나, 아예 **'키를 사용하지 않는'** 방식을 사용하여 보안과 효율성을 동시에 확보합니다.

실전에서 사용하는 4가지 주요 전략을 단계별로 정리합니다.

---

### 1. 전략 1: 용도별/환경별 키 통합 (Key Re-using)

가장 기초적인 방법은 **'하나의 키 페어로 여러 서버를 관리'**하는 것입니다. 모든 서버마다 키를 만드는 것이 아니라, 논리적인 그룹 단위로 키를 하나만 생성하여 돌려 씁니다.

* **관리 방식:**
* **dev-key.pem:** 개발계(Development) 서버 100대에 공통 등록.
* **prod-key.pem:** 운영계(Production) 서버 50대에 공통 등록.


* **장점:** 관리가 단순합니다.
* **단점:** 키 파일 하나가 유출되면 해당 그룹의 모든 서버가 위험해집니다. 따라서 주기적인 키 교체(Rotation)가 필수적입니다.

---

### 2. 전략 2: 자체 키 생성 및 업로드 (Import Key Pair)

AWS가 만들어주는 `.pem` 파일을 다운로드받아 팀원끼리 메신저로 공유하는 것은 **보안상 최악의 습관**입니다. 실무에서는 **'각자의 자물쇠(Public Key)'를 서버에 심는 방식**을 사용합니다.

1. **개인별 키 생성:** 엔지니어 A, B, C는 각자의 PC에서 `ssh-keygen` 명령어로 자신만의 키 쌍(Private/Public)을 생성합니다.
2. **공개키(Public Key) 취합:** A, B, C의 공개키(`id_rsa.pub`)만 모읍니다. (공개키는 남에게 보여줘도 안전함)
3. **AWS에 등록:** EC2 생성 시 'Import Key Pair' 기능을 통해 취합된 공개키를 등록하거나, 서버 시작 스크립트(User Data)를 통해 `~/.ssh/authorized_keys` 파일에 엔지니어들의 공개키를 모두 등록합니다.
4. **결과:** A는 A의 키로, B는 B의 키로 **동일한 서버에 접속**할 수 있습니다. 퇴사자가 발생하면 해당 서버에서 그 사람의 공개키 한 줄만 지우면 됩니다.

---

### 3. 전략 3: 배스천 호스트 (Bastion Host) 활용

모든 서버에 공인 IP를 부여하고 22번 포트를 여는 것은 위험합니다. **'단 하나의 출입구'**만 관리하는 방식입니다.

* **구조:**
* **Bastion Host (Jump Server):** 유일하게 공인 IP를 갖고 외부 접속을 허용하는 서버입니다. 보안을 철저하게 관리(MFA 적용 등)합니다.
* **Private Instances:** 공인 IP 없이 사설망(Private Subnet)에 숨어 있습니다. 오직 Bastion Host에서의 접속만 허용합니다.


* **관리:** 관리자는 Bastion Host에 접속하기 위한 키 하나만 철저히 관리하면 됩니다. 내부 서버들 간의 접속은 내부 전용 키를 두거나 신뢰 관계 설정을 통해 해결합니다.

---

### 4. 전략 4: AWS SSM Session Manager (★최신 트렌드/강력 추천)

최근 클라우드 네이티브 환경에서는 **SSH 키 자체를 없애는(Keyless)** 추세입니다. AWS Systems Manager(SSM)를 사용하면 22번 포트를 열 필요도, 키를 관리할 필요도 없습니다.

* **작동 원리:**
1. EC2 인스턴스에 `SSM Agent`가 설치되어 있어야 합니다. (최신 AMI는 기본 설치됨)
2. EC2에 적절한 **IAM 권한(Role)**을 부여합니다.
3. 사용자는 AWS 콘솔이나 CLI를 통해 인증된 후, 브라우저나 터미널에서 즉시 셸(Shell) 접속을 얻습니다.


* **장점:**
* **보안:** SSH 키 분실/유출 걱정이 0%입니다.
* **네트워크:** 22번 포트를 아예 닫아버려도 접속 가능하므로 해킹 시도를 원천 차단합니다.
* **감사(Audit):** 누가 언제 접속해서 무슨 명령어를 쳤는지 로그가 남습니다.



---

### 5. 실무 적용 요약표

| 단계 | 방식 | 특징 | 추천 대상 |
| --- | --- | --- | --- |
| **초급** | **키 재사용** | 환경별(Dev/Prod)로 1개씩만 생성 | 소규모 개인 프로젝트 |
| **중급** | **Bastion Host** | 외부 접점을 1개로 축소하여 집중 관리 | 일반적인 기업 인프라 |
| **고급** | **SSM Session Manager** | **SSH 키 미사용 (Keyless)**, IAM 권한으로 제어 | **보안이 중요한 모든 엔터프라이즈 환경** |

**결론적으로 실전에서는:**
소규모 팀이라면 **전략 2(개인별 키 등록)**와 **전략 3(Bastion)**을 혼합해 사용하며, 보안 규정이 엄격하거나 대규모 환경에서는 **전략 4(SSM)**로 전환하여 SSH 키 관리 부담을 완전히 없애는 것이 표준입니다.

Next Step: SSH 키 없이 서버에 접속하는 AWS Systems Manager(SSM) Session Manager 실습

----
## AWS Systems Manager (SSM) Session Manager 비용 구조 및 과금 상세

AWS Systems Manager(SSM) Session Manager를 사용하여 EC2에 접속하는 방식(전략 4)은 보안성과 편의성이 뛰어나면서도, 기본 기능 사용 시 **무료**라는 강력한 장점이 있습니다. 그러나 감사 로그 저장이나 고급 기능을 사용할 경우 연관된 서비스에서 **종량제 과금**이 발생하므로 정확한 비용 구조를 이해해야 합니다.

---

### 1. 기본 비용: 0원 (무료)

SSM Session Manager의 표준 기능인 'EC2 인스턴스에 대한 쉘(Shell) 접속' 자체는 **완전 무료**입니다.

* **대상:** AWS EC2 인스턴스 (Standard Instances)
* **비용:** **$0 (Free)**
* **포함 사항:**
* 세션 시작 및 종료
* 브라우저 및 CLI를 통한 접속 데이터 전송
* 사용자별 접근 제어(IAM) 기능



> **참고:** EC2가 아닌 온프레미스 서버나 타 클라우드 서버에 SSM 에이전트를 설치하여 관리하는 경우(Advanced Instances)에는 시간당 약 $0.00695의 비용이 발생하지만, 순수 AWS EC2 환경에서는 무료입니다.

---

### 2. 추가 비용 발생 요소 (선택 사항)

SSM 자체는 무료이지만, 보안 강화를 위해 연동하는 기능에서 비용이 발생합니다. 실무에서는 감사(Audit)를 위해 로그 저장이 필수적이므로 이 부분의 예산을 고려해야 합니다.

#### A. 세션 로그 저장 비용 **(유료)**

누가 언제 접속해서 어떤 명령어를 입력했는지 기록을 남기기 위해 로그를 다른 저장소로 보낼 때 발생합니다.

| 저장소 종류 | 과금 항목 | 예상 비용 (2026 서울 리전 기준) |
| --- | --- | --- |
| **CloudWatch Logs** | 데이터 수집(Ingestion) + 보관(Storage) | • 수집: $0.50 / GB<br>

<br>• 보관: $0.03 / GB |
| **Amazon S3** | 스토리지 저장 + 요청 수 | • 저장: $0.023 / GB (Standard)<br>

<br>• 요청: $0.005 / 1,000 요청 |

* **특징:** 텍스트 기반의 쉘 명령어 로그는 용량이 매우 작아(수 KB 단위), 비용 부담이 크지 않습니다.
* **예시:** 매일 10명의 개발자가 접속해도 월 $1 미만의 비용이 발생하는 경우가 대부분입니다.

#### B. KMS 암호화 비용 **(유료)**

세션 데이터 스트림을 기본 암호화(TLS 1.2) 외에, 사용자가 직접 관리하는 키(CMK)로 추가 암호화할 경우 발생합니다.

* **AWS KMS:** 키 당 월 $1.00 + API 요청 비용 ($0.03 / 10,000회)
* **특징:** 규제 준수(Compliance) 요건이 없다면 굳이 설정하지 않아도 기본 보안 수준이 높습니다.

---

### 3. 기존 방식(Bastion Host)과 비용 비교

기존의 Bastion Host(점프 서버) 방식과 SSM 방식을 비교하면, SSM이 운영 비용 절감 측면에서 훨씬 유리합니다.

| 비교 항목 | Bastion Host 운영 (전략 3) | SSM Session Manager (전략 4) |
| --- | --- | --- |
| **인프라 비용** | **유료** (t3.micro 1대 기준 월 약 $10 이상) | **무료** ($0) |
| **EIP(공인IP) 비용** | **유료** (시간당 과금, 월 약 $3.6) | **무료** (공인 IP 필요 없음) |
| **관리 인력 비용** | 보안 패치, OS 업데이트 등 지속 관리 필요 | 관리 불필요 (Serverless) |
| **총 비용** | **월 $13.6 + α** | **월 $0 ~ $1** (로그 비용 포함 시) |

---

### 4. 비용 최적화 및 주의사항

1. **로그 보관 기간 설정:** CloudWatch Logs에 저장된 세션 로그를 '무제한'으로 두지 말고, **보관 주기(Retention)**를 30일~90일로 설정하여 불필요한 스토리지 비용을 방지해야 합니다.
2. **S3 수명 주기 정책:** S3로 로그를 보낼 경우, 오래된 로그는 저렴한 스토리지 클래스(Glacier 등)로 자동 이동되도록 설정합니다.
3. **프리 티어:** CloudWatch Logs는 프리 티어(월 5GB 수집 무료)가 적용되므로, 소규모 실습 환경에서는 로그 기능을 켜더라도 실제 청구액은 **0원**일 가능성이 높습니다.

---

Next Step: SSM Agent 설치 확인 및 IAM 권한(AmazonSSMManagedInstanceCore) 설정 실습
