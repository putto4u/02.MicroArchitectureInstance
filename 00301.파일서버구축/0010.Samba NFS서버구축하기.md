

# Ubuntu VM을 활용한 파일 서버 구축 실무

## 1. 파일 서버 구축을 위한 사전 준비 (필수)

가상머신(VM)을 단순한 개인 연습용이 아닌 '서버'로 동작시키기 위해서는 네트워크 설정이 가장 중요하다.

### 1.1 VM 네트워크 모드 설정 (VirtualBox/VMware 공통)

파일 서버는 외부(호스트 PC 또는 같은 공유기를 쓰는 다른 PC)에서 접근 가능해야 한다.

* **NAT (기본값):** ❌ 비권장. VM이 외부와 격리되어 있어, 외부에서 VM으로 접속하려면 복잡한 포트 포워딩이 필요하다.
* **어댑터에 브리지 (Bridged Adapter):** ✅ **권장.** VM이 공유기로부터 공유기 대역(예: 192.168.0.x)의 독자적인 IP를 할당받는다. 호스트 PC와 동등한 네트워크 위치를 가지므로 서버 구축에 적합하다.

### 1.2 서버 업데이트 및 IP 확인

터미널을 열고 다음 명령어를 수행하여 패키지를 최신화하고 현재 IP를 확인한다.

```bash
sudo apt update && sudo apt upgrade -y
ip addr show
# (결과에서 inet 192.168.x.x 형태의 IP 주소를 메모해둔다.)

```

---

## 2. 시나리오 A: Samba (SMB) - 윈도우와 호환되는 표준 파일 서버

가장 범용적인 방식이다. 윈도우(Windows), 맥(Mac), 리눅스 모두에서 별도 프로그램 없이 폴더처럼 접근 가능하다.

### 2.1 설치

```bash
sudo apt install samba -y

```

### 2.2 공유 폴더 생성 및 권한 설정

공유할 실제 디렉터리를 만들고 권한을 부여한다.

```bash
# 홈 디렉터리에 share 폴더 생성
mkdir -p /home/$USER/share

# 누구든 읽고 쓸 수 있게 설정 (보안상 취약하나 실습용으로 권장)
chmod 777 /home/$USER/share

```

### 2.3 Samba 설정 파일 수정 (`/etc/samba/smb.conf`)

설정 파일을 열고 맨 아래에 다음 내용을 추가한다.

```bash
sudo nano /etc/samba/smb.conf

```

**[추가할 내용]**

```ini
[MyFileServer]
   path = /home/우분투사용자명/share
   writable = yes
   guest ok = no
   read only = no
   create mask = 0777
   directory mask = 0777
   valid users = 우분투사용자명

```

*(주의: `우분투사용자명` 부분을 실제 계정명으로 변경할 것)*

### 2.4 Samba 사용자 비밀번호 설정 (중요)

Samba는 리눅스 계정을 사용하지만, **비밀번호는 별도로 관리**한다.

```bash
sudo smbpasswd -a 우분투사용자명
# (사용할 비밀번호 입력)

```

### 2.5 서비스 재시작

```bash
sudo systemctl restart smbd

```

### 2.6 접속 테스트

* **Windows:** 실행(Win+R) → `\\VM_IP주소` 입력 (예: `\\192.168.0.50`)
* **Mac:** Finder → 이동 → 서버에 연결 → `smb://VM_IP주소`

---

## 3. 시나리오 B: NFS (Network File System) - 리눅스 간 고속 공유

클라이언트가 리눅스(다른 VM, 라즈베리파이 등)인 경우 오버헤드가 적고 속도가 빠른 NFS를 사용한다.

### 3.1 설치

```bash
sudo apt install nfs-kernel-server -y

```

### 3.2 공유 설정 (`/etc/exports`)

NFS는 설정 파일에 '누구에게 공유할지'를 명시해야 한다.

```bash
sudo nano /etc/exports

```

**[추가할 내용]**

```text
/home/우분투사용자명/share  *(rw,sync,no_root_squash,no_subtree_check)

```

* `*`: 모든 IP 허용 (보안을 위해 `192.168.0.10(rw)` 처럼 특정 IP 지정 권장)
* `rw`: 읽기/쓰기 허용
* `sync`: 데이터 변경 사항을 즉시 디스크에 기록 (안정성)

### 3.3 적용 및 서비스 시작

```bash
sudo exportfs -a
sudo systemctl restart nfs-kernel-server

```

### 3.4 클라이언트(다른 리눅스)에서 마운트

```bash
# 클라이언트 PC에서
sudo mount -t nfs [서버IP]:/home/우분투사용자명/share /mnt/my_mount_point

```

---

## 4. 시나리오 C: SFTP (SSH) - 별도 설치 없는 간편 전송

SSH(Secure Shell)가 설치되어 있다면 SFTP도 이미 작동 중이다. 가장 보안성이 높고 설정이 필요 없다.

* **준비물:** SSH 서버 설치 (`sudo apt install openssh-server`)
* **접속 도구:** FileZilla, WinSCP (Windows), CyberDuck (Mac)
* **접속 방법:**
* 프로토콜: SFTP
* 호스트: VM IP 주소
* 사용자/비번: 우분투 계정 정보 그대로 사용



---

## 5. 프로토콜별 비교 및 선택 가이드

| 프로토콜 | Samba (SMB) | NFS | SFTP |
| --- | --- | --- | --- |
| **주 호환성** | **Windows**, Mac, Linux | **Linux**, Unix | 모든 OS (전용 클라이언트 필요) |
| **성능** | 보통 (오버헤드 존재) | **빠름** (커널 레벨 동작) | 보통 (암호화 부하 존재) |
| **편의성** | 높음 (네트워크 드라이브로 잡힘) | 보통 (마운트 명령 필요) | 낮음 (전용 프로그램 필요) |
| **주 용도** | 사내/가정용 파일 공유, 협업 | 서버 간 데이터 공유, 클러스터링 | 원격지 파일 전송, 보안 전송 |

---

## 6. 방화벽(UFW) 설정 주의사항

연결이 안 된다면 우분투 방화벽이 포트를 막고 있을 확률이 높다. 필요한 포트만 열어준다.

```bash
# 방화벽 상태 확인
sudo ufw status

# Samba 포트 허용
sudo ufw allow samba

# NFS 포트 허용 (NFS는 포트가 유동적이므로 로컬 대역 전체 허용 권장)
sudo ufw allow from 192.168.0.0/24 to any port nfs

# SSH(SFTP) 허용
sudo ufw allow ssh

# 방화벽 활성화
sudo ufw enable

```

---

Next Step: Linux Permissions (chmod, chown, chgrp) & ACL Detailed Guide
