# 제 5장. 하이브리드 클라우드 전략: 메인 센터(Primary) 선정 기준

하이브리드 클라우드 설계 시 가장 중요한 의사결정은 **"어디를 주(Primary) 센터로 두고, 어디를 보조(Secondary) 또는 확장 영역으로 사용할 것인가?"**입니다. 이는 단순한 기술적 선호가 아닌, 비즈니스의 성격, 데이터의 중력(Data Gravity), 규제 준수 여부에 따라 결정됩니다.

---

## 1. 시나리오 A: 본사(On-Premises)를 메인으로 하는 경우

이 모델은 **"보안과 통제"**가 최우선이며, 클라우드는 보조적인 수단(백업, 일시적 부하 분산)으로 활용하는 형태입니다.

### 1.1 판단 근거 및 특징

* **데이터 주권 및 규제 준수:** 금융, 공공, 의료 등 법적으로 데이터의 외부 반출이 엄격히 제한되거나, 특정 물리적 위치에 데이터가 존재해야 하는 경우입니다.
* **고정된 워크로드의 비용 효율성:** 24시간 365일 변동 없이 일정하게 돌아가는 대규모 레거시 시스템의 경우, 이미 감가상각이 끝난 자체 장비를 쓰는 것이 클라우드 임대 비용보다 저렴할 수 있습니다.
* **초저지연(Low Latency) 요구:** 공장 설비 제어와 같이 1ms 이하의 응답속도가 필요한 경우, 물리적으로 가까운 온프레미스 서버가 필수적입니다.

### 1.2 실제 사례 (Use Cases)

* **제조업 (Smart Factory):** 반도체 생산 라인의 공정 데이터 수집 및 장비 제어 시스템(MES)은 공장 내부 서버실(On-Prem)을 메인으로 둡니다. 네트워크 지연 시 생산 중단 사고로 이어질 수 있기 때문입니다. CSP는 수집된 데이터를 분석하거나 장기 보관하는 용도로만 사용합니다.
* **금융권 (Core Banking):** 계정계(원장 관리) 시스템은 보안성과 트랜잭션의 무결성을 위해 자체 IDC의 메인프레임이나 유닉스 서버에서 구동합니다. CSP는 대고객용 웹서비스나 비식별 데이터 분석 용도로 제한적으로 활용합니다.

> **핵심 역할 분담:**
> * **On-Prem (Main):** 핵심 데이터 저장, 트랜잭션 처리, 민감 정보 관리.
> * **CSP (Sub):** 재해 복구(DR) 센터, 개발/테스트(Dev/Test) 환경, 갑작스러운 트래픽 폭주 시 '클라우드 버스팅(Cloud Bursting)' 용도.
> 
> 

---

## 2. 시나리오 B: CSP(Public Cloud)를 메인으로 하는 경우

이 모델은 **"속도와 확장성"**이 최우선이며, 온프레미스는 특수한 목적(레거시 연동, 보안)을 위해 최소한으로 유지하는 형태입니다.

### 2.1 판단 근거 및 특징

* **글로벌 서비스 및 확장성:** 전 세계 사용자에게 서비스를 제공해야 하거나(CDN 활용), 트래픽 예측이 불가능한 B2C 서비스에 적합합니다.
* **Time-to-Market (민첩성):** 하드웨어 발주 및 설치 대기 시간 없이, 클릭 몇 번으로 인프라를 구성하고 즉시 서비스를 런칭해야 하는 경우입니다.
* **최신 기술 활용:** AI, Big Data, Serverless 등 CSP가 제공하는 매니지드 서비스(PaaS/SaaS)를 주력으로 사용하여 개발 생산성을 높이려는 경우입니다.

### 2.2 실제 사례 (Use Cases)

* **이커머스/유통 (Global Retail):** 블랙프라이데이와 같이 특정 시기에 트래픽이 10배 이상 폭증하는 쇼핑몰은 CSP를 메인으로 둡니다. 자체 서버로 이 트래픽을 감당하려면 평소에 막대한 유휴 자원 비용이 발생하기 때문입니다.
* **게임/미디어 (Streaming):** 넷플릭스(Netflix)와 같은 서비스는 콘텐츠 전송과 서비스 로직을 모두 AWS와 같은 CSP에 둡니다. 온프레미스는 자체 콘텐츠 제작 스튜디오 내의 편집/렌더링 작업용으로만 국한하여 사용합니다.

> **핵심 역할 분담:**
> * **CSP (Main):** 웹/앱 서비스 호스팅, DB 운영, 글로벌 트래픽 처리.
> * **On-Prem (Sub):** 클라우드로 이전 불가능한 레거시 장비 유지, 물리적 보안 키 관리, 사내 보안 접속 게이트웨이 역할.
> 
> 

---

## 3. 비교 분석 및 의사결정 프레임워크

메인 센터를 결정할 때는 **데이터 중력(Data Gravity)** 이론을 따르는 것이 정석입니다. "데이터가 가장 많이 생성되고, 가장 많이 머무르는 곳"에 컴퓨팅 파워(메인 센터)를 배치해야 성능과 비용(Egress Cost) 문제를 해결할 수 있습니다.

| 구분 | On-Premises Main (보수적 접근) | CSP Main (혁신적 접근) |
| --- | --- | --- |
| **적합한 기업 유형** | 제조, 금융, 공공, 방산 | 스타트업, 유통, 게임, 미디어, 서비스 |
| **핵심 가치** | **Control (통제)**, Compliance (규제), Stability (안정) | **Agility (민첩)**, Scalability (확장), Innovation (혁신) |
| **비용 모델** | CAPEX (자본 지출, 초기 투자 큼) | OPEX (운영 비용, 쓴 만큼 지불) |
| **기술적 제약** | 하드웨어 노후화, 확장 시 리드타임 발생 | 벤더 종속(Lock-in), 클라우드 보안 책임 공유 모델 |
| **네트워크 구성** | 폐쇄망 중심, 전용회선(Direct Connect) 필수 | 인터넷망 중심, VPN 또는 SD-WAN 활용 |

### [강사의 조언]

단순히 트렌드를 좇아 CSP를 메인으로 정하는 것은 위험합니다.

1. **Workload Assessment:** 우리 회사의 업무가 '변동성'이 큰가? (CSP 유리) 아니면 '예측 가능'한가? (On-Prem 유리)
2. **Data Egress Cost:** 메인 데이터를 CSP에 두고 온프레미스로 자주 내려받아야 한다면, 막대한 네트워크 비용이 발생할 수 있습니다.
3. **Legacy Dependency:** 수십 년 된 메인프레임 코드를 당장 클라우드로 옮기는(Re-hosting) 것은 기술적으로 불가능하거나 리스크가 너무 클 수 있습니다. 이 경우 'On-Prem Main' 형태를 유지하며 신규 서비스만 CSP에 구축하는 '2-Tier' 전략이 유효합니다. 

---

# 제 6장. IaC(Infrastructure as Code) 구축 및 관리 난이도 비교

**결론부터 말하자면, 테라폼(Terraform)을 이용한 구축과 관리 난이도는 '온프레미스(On-Premises)'가 압도적으로 높습니다.**

만약 두 환경 중 어느 것을 선택해도 되는 상황이라면, **CSP(Public Cloud)를 메인으로 선택하는 것이 IaC 운영 측면에서 정신 건강과 효율성에 훨씬 유리**합니다. 그 기술적 이유와 구조적 차이를 상세히 분석합니다.

---

## 1. 근본적인 차이: API의 존재 유무

테라폼은 마법이 아닙니다. 테라폼은 대상 인프라가 제공하는 **API(Application Programming Interface)**를 호출하여 자원을 생성하는 도구입니다.

### 1.1 CSP Main (난이도: 하 ~ 중)

AWS, Azure, Google Cloud는 태생이 **"모든 것이 소프트웨어로 정의된(Software Defined)"** 환경입니다.

* **완벽한 API 제공:** CSP의 모든 리소스(VM, 네트워크, 스토리지, DB 등)는 이미 API로 추상화되어 있습니다. 테라폼은 이 API와 1:1로 매핑만 하면 됩니다.
* **물리 계층 무시:** 사용자는 물리 서버의 전원, 케이블 연결, 스위치 포트 구성 등을 전혀 신경 쓸 필요가 없습니다. 오직 논리적인 리소스만 코드로 정의하면 됩니다.

### 1.2 On-Premises Main (난이도: 상 ~ 최상)

온프레미스는 기본적으로 **물리적 하드웨어**입니다. 깡통 서버(Bare Metal)는 테라폼이 말을 걸 수 있는 API가 없습니다.

* **선결 과제 (The Chicken and Egg):** 테라폼을 쓰기 위해서는 하드웨어를 추상화해 줄 **가상화 플랫폼(VMware vSphere, OpenStack, Nutanix 등)을 먼저 구축**해야 합니다. 이 가상화 플랫폼 자체를 구축하고 유지보수하는 것은 별도의 거대한 작업입니다.
* **물리적 제약:** 테라폼으로 VM을 100개 생성하라고 코드를 짰어도, 실제 물리 서버의 RAM이 부족하거나 스토리지 용량이 없으면 에러를 뱉고 멈춥니다. CSP처럼 "무한한 자원"을 전제로 코딩할 수 없습니다.

---

## 2. 영역별 난이도 상세 비교

| 비교 항목 | CSP Main (Public Cloud) | On-Premises Main (Private Cloud) |
| --- | --- | --- |
| **네트워크 구성** | **쉬움.** `aws_vpc`, `aws_subnet` 등으로 논리적 망 분리가 끝납니다. | **어려움.** 물리적 스위치(L2/L3), 케이블링, VLAN 구성을 먼저 해야 합니다. 테라폼으로 물리 스위치(Cisco ACI 등)를 제어하려면 난이도가 급상승합니다. |
| **로드 밸런서** | **매우 쉬움.** `aws_lb` 리소스 하나면 L4/L7 스위치가 생성됩니다. | **복잡함.** F5 Big-IP나 Citrix 같은 하드웨어 장비를 쓰거나, HAProxy 같은 소프트웨어를 별도 서버에 설치하고 설정해야 합니다. |
| **스토리지** | **쉬움.** 원하는 용량과 IOPS만 숫자로 적으면 즉시 할당됩니다. | **매우 어려움.** SAN/NAS 스위치 조닝(Zoning), LUN 할당, 물리적 디스크 증설 작업이 선행되어야 테라폼이 볼륨을 잡을 수 있습니다. |
| **프로바이더 성숙도** | **최상.** AWS/Azure 프로바이더는 문서화가 완벽하고 커뮤니티 예제가 넘쳐납니다. | **중/하.** VMware(vSphere) 프로바이더 외에는 기능 제약이 많거나 버그가 있을 수 있으며, 예제 코드를 찾기 어렵습니다. |

---

## 3. 코드 작성 및 관리의 실제 차이

### 3.1 CSP 환경의 Terraform

코드가 직관적이고 "선언한 대로" 즉시 만들어집니다.

```hcl
# AWS 예시: 단순 명료함
resource "aws_instance" "web" {
  ami           = "ami-12345678"
  instance_type = "t2.micro"
  # 물리적 위치를 몰라도 됨 (가용 영역만 지정)
}

```

### 3.2 온프레미스 환경의 Terraform (vSphere 예시)

단순히 VM 하나를 만들기 위해서도 물리적 인프라의 구체적인 정보를 모두 알고 지정해줘야 합니다.

```hcl
# vSphere 예시: 사전에 정의된 데이터소스가 필수적임
data "vsphere_datacenter" "dc" { name = "Busan-DC-01" }
data "vsphere_datastore" "ds" { name = "SAN-Storage-01" }
data "vsphere_compute_cluster" "cluster" { name = "Cluster-A" }
data "vsphere_network" "net" { name = "VLAN_10_Internal" }

resource "vsphere_virtual_machine" "vm" {
  # 리소스 풀, 데이터스토어 등 물리적 제약을 일일이 지정해야 함
  resource_pool_id = data.vsphere_compute_cluster.cluster.resource_pool_id
  datastore_id     = data.vsphere_datastore.ds.id
  # ... (이하 생략)
}

```

---

## 4. 관리 포인트 및 리스크 (Day 2 Operation)

### 4.1 상태 관리 (State Management)

* **CSP:** S3와 DynamoDB를 이용해 테라폼의 상태 파일(`tfstate`)을 안전하게 저장하고 잠금(Locking)을 걸기 매우 쉽습니다.
* **On-Prem:** 상태 파일을 저장할 고가용성 스토리지(MinIO, Consul, 혹은 별도 DB)를 **직접 구축하고 관리**해야 합니다. 상태 저장소가 죽으면 IaC도 마비됩니다.

### 4.2 업데이트 및 패치

* **CSP:** 클라우드 벤더가 하드웨어 펌웨어, 하이퍼바이저 패치를 알아서 수행합니다. 테라폼 코드 수정 불필요.
* **On-Prem:** 하이퍼바이저(ESXi 등) 버전 업그레이드 시 테라폼 프로바이더 호환성이 깨질 수 있습니다. 물리 장비 점검 시 테라폼 작업을 중단해야 합니다.

---

## 5. 요약 및 제언

**"하드웨어를 소프트웨어처럼 다루는 것"**이 IaC의 핵심입니다.

* **CSP**는 이미 하드웨어가 소프트웨어화 되어 있으므로 테라폼과 찰떡궁합입니다.
* **온프레미스**는 하드웨어를 소프트웨어화 하는 과정(Private Cloud 구축)이 선행되어야 하며, 그 후에도 물리적 제약사항(Capacity, Network cabling) 때문에 테라폼 자동화가 자주 끊깁니다.

따라서 **구축 및 관리의 용이성, 학습 곡선, 운영 효율**을 고려한다면 **CSP(Public Cloud)가 압도적으로 유리**합니다. 온프레미스에서 테라폼을 제대로 쓰려면 사실상 "사내에 AWS와 같은 플랫폼을 직접 개발해서 운영하는 수준"의 역량이 필요합니다.

---


