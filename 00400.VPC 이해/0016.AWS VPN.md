AWS **Site-to-Site VPN**은 온프레미스 네트워크(사무실 또는 데이터 센터)와 AWS VPC 간에 보안이 유지된 사설 연결을 생성하는 서비스입니다. 공용 인터넷을 통로로 사용하지만, 데이터를 암호화(IPsec)하여 전송하므로 안전한 하이브리드 클라우드 환경을 구축할 수 있습니다.

---

## 1. AWS VPN의 핵심 구성 요소

VPN 연결을 성립시키기 위해서는 AWS 쪽과 사용자 쪽 각각에 '대문' 역할을 하는 리소스가 필요합니다.

### ① 가상 프라이빗 게이트웨이 (VGW) 또는 Transit Gateway (TGW)

* **VGW**: 하나의 VPC와 연결되는 고전적인 VPN 종단점입니다.
* **TGW**: 여러 VPC를 중앙에서 연결할 때 사용하며, VPN 연결을 TGW에 연결하여 여러 VPC가 공유하게 할 수 있습니다.

### ② 고객 게이트웨이 (Customer Gateway, CGW)

* 사용자의 온프레미스 측에 위치한 물리적 장치 또는 소프트웨어 어플라이언스를 AWS에 등록한 리소스입니다. (실제 장비의 공인 IP 주소가 필요합니다.)

### ③ VPN 연결 (VPN Connection)

* VGW/TGW와 CGW 사이를 잇는 실제 통신 터널입니다. 가용성을 위해 **2개의 터널**이 기본으로 생성됩니다.

---

## 2. VPN 연결 방식 (라우팅)

* **정적 라우팅 (Static Routing)**: 온프레미스의 IP 대역을 직접 입력하여 경로를 지정합니다. 네트워크 규모가 작고 변화가 적을 때 사용합니다.
* **동적 라우팅 (Dynamic Routing)**: **BGP(Border Gateway Protocol)**를 사용하여 네트워크 정보를 자동으로 교환합니다. 다중 터널을 통한 경로 최적화 및 장애 복구(Failover)가 유리합니다.

---

## 3. AWS VPN vs Direct Connect (DX)

| 구분 | Site-to-Site VPN | Direct Connect |
| --- | --- | --- |
| **연결 통로** | 공용 인터넷 (IPsec 암호화) | 전용 회선 (물리적 연결) |
| **설정 시간** | 몇 분 이내 (빠름) | 수 주 ~ 수 개월 (느림) |
| **안정성** | 인터넷 환경에 따라 가변적 | 매우 높음 (일관된 대역폭) |
| **비용** | 낮음 | 높음 |

---

## 4. AWS VPN 과금 및 유료 전환 주의 사항 (2026년 기준)

VPN은 설정하는 순간부터 시간당 고정 비용이 발생하므로 사용하지 않을 때는 리소스를 삭제해야 합니다.

| 항목 | 과금 방식 (Seoul Region 기준) | 비고 |
| --- | --- | --- |
| **Site-to-Site VPN 연결 요금** | **$0.048 / 시간당** | 연결 하나당 발생 (터널 2개 포함) |
| **데이터 전송 요금 (Outbound)** | **$0.126 / GB** | AWS에서 온프레미스로 나가는 데이터에 부과 |
| **Accelerated VPN (옵션)** | **$0.05 / 시간당 + 글로벌 전송비** | AWS Global Accelerator 사용 시 추가 부과 |
| **Client VPN (사용자용)** | **$0.05 / 시간당 (엔드포인트) + $0.05 / 시간당 (접속자)** | 개별 PC 접속 시 별도 과금 체계 적용 |

> [!WARNING]
> **과금 주의 사항**
> * VPN 연결을 생성하고 `Customer Gateway`를 등록해두면, 실제 트래픽이 흐르지 않아도 **시간당 연결 요금($0.048)**이 계속 부과됩니다.
> * 테스트가 끝난 후에는 반드시 `VPN Connection`을 삭제(Delete)해야 과금이 멈춥니다. (VGW나 CGW 리소스 자체는 삭제하지 않아도 비용이 들지 않지만, 연결은 반드시 끊어야 합니다.)
> 
> 

---

## 5. 실무 설정 팁: 고가용성(HA) 확보

1. **듀얼 터널 활용**: AWS는 기본적으로 2개의 터널 엔드포인트를 제공합니다. 온프레미스 장비에서도 2개의 터널을 모두 활성화하여 한쪽 터널에 장애가 발생해도 서비스가 유지되도록 설정하십시오.
2. **라우팅 전파 (Route Propagation)**: VPC 라우팅 테이블에서 'Route Propagation'을 활성화하면 VPN을 통해 넘어오는 온프레미스 대역이 자동으로 라우팅 테이블에 등록되어 관리가 편리합니다.

---
Transit Gateway(TGW)는 연결 대상이 VPC이든 온프레미스 VPN이든 관계없이 동일한 중앙 집중형 허브 역할을 수행하지만, 연결되는 방식과 아키텍처적 위치에 따라 몇 가지 중요한 공통점과 차이점이 있습니다.

---

## 1. TGW 기반 VPN과 허브 앤 스포크 TGW 비교

| 구분 | VPN 연결을 위한 TGW | 허브 앤 스포크(VPC) TGW |
| --- | --- | --- |
| **주요 역할** | 온프레미스와 클라우드 간의 **연결 통로** | 여러 VPC 간의 **중앙 라우팅 허브** |
| **연결 대상** | Customer Gateway (물리 장비/SW) | VPC 서브넷 (Attachment) |
| **프로토콜** | **IPsec VPN, BGP** (동적 라우팅 권장) | AWS 전용 백본 프로토콜 |
| **전이적 루팅** | 온프레미스 ↔ TGW ↔ 여러 VPC 가능 | VPC A ↔ TGW ↔ VPC B 가능 |
| **대역폭** | 터널당 최대 **1.25 Gbps** (ECMP로 확장 가능) | 연결당 최대 **50 Gbps** |

---

## 2. 공통점: 왜 둘 다 TGW를 쓰는가?

### ① 전이적 라우팅(Transitive Routing)의 중심

가장 큰 공통점은 **중앙 집중화**입니다.

* VPC 피어링이나 일반 VGW 기반 VPN은 1:1 연결만 가능하여 전이적 루팅이 안 되지만, TGW는 VPN으로 들어온 트래픽을 연결된 모든 VPC로 전달할 수 있고, 반대로 여러 VPC 트래픽을 하나의 VPN 라인을 통해 본사로 보낼 수 있습니다.

### ② 확장성 (Scalability)

* 수천 개의 VPC와 온프레미스 사이트를 하나의 TGW 라우팅 테이블에서 통합 관리할 수 있다는 점이 동일합니다.

---

## 3. 구조적 차이점 상세 분석

### ① 아키텍처적 위치

* **허브 앤 스포크 TGW**: 주로 '리전 내' 또는 '리전 간' VPC들을 묶어주는 내부 망 구성에 집중합니다.
* **VPN TGW**: '외부(On-premise)'와 '내부(AWS)'를 잇는 게이트웨이 역할을 수행하며, 외부 망과의 암호화 통신을 처리합니다.

### ② 대역폭과 성능 제한

* **VPC 연결**은 AWS 내부 망을 사용하므로 대역폭이 매우 높고 안정적입니다.
* **VPN 연결**은 인터넷을 공용망으로 사용하며 터널당 1.25Gbps라는 하드웨어적 한계가 있습니다. (이를 극복하기 위해 TGW는 여러 터널을 묶는 ECMP 기술을 지원합니다.)

### ③ 관리 포인트

* **VPC 연결**: AWS 콘솔 내에서 Attachment 설정만으로 끝납니다.
* **VPN 연결**: 외부 장비(Cisco, Fortinet 등)와의 **IKE 정책, 사전 공유 키(PSK), BGP ASN** 설정 등 네트워크 엔지니어링 작업이 추가로 필요합니다.

---

## 4. 통합 실무 시나리오 (Hub & Spoke + VPN)

일반적으로 기업에서는 이 두 가지를 섞어서 **"Global Transit Network"**를 구축합니다.

1. **중앙 허브**: TGW를 생성합니다.
2. **Spoke 연결**: 서비스용 VPC A, B, C를 TGW에 연결합니다. (허브 앤 스포크 구성)
3. **외부 연결**: 본사 IDC와 TGW 간에 Site-to-Site VPN을 맺습니다.
4. **효과**: 본사 직원은 VPN 터널 하나만 통과하면 TGW라는 허브를 통해 VPC A, B, C 어디든(권한이 있다면) 사설 IP로 접속할 수 있습니다.

---

## 5. AWS 과금 및 유료 전환 주의 사항

이 구성에서는 두 종류의 요금이 합산되어 발생하므로 비용 설계 시 주의해야 합니다.

| 항목 | 요금 방식 | 비고 |
| --- | --- | --- |
| **TGW VPC Attachment** | **$0.07 / 시간당** | 연결된 VPC 개수만큼 발생 |
| **TGW VPN Attachment** | **$0.07 / 시간당** | VPN 연결 개수만큼 발생 (VPC 연결 요금과 동일) |
| **VPN 연결 유지비** | **$0.048 / 시간당** | VPN 서비스 자체 비용 (중복 부과) |
| **데이터 처리비** | **$0.02 / GB** | TGW를 통과하는 모든 데이터에 부과 |

> [!WARNING]
> **비용 합계 주의**: VPC 3개를 TGW에 연결하고 본사와 VPN 1개를 맺으면, 시간당 요금은 `($0.07 * 4) + $0.048 = $0.328`이 됩니다. 한 달이면 약 **$236(약 31만 원)**의 고정비가 발생하며, 데이터 전송료는 별도입니다.

Next Step: ECMP를 이용한 VPN 대역폭 확장 및 경로 최적화

---
