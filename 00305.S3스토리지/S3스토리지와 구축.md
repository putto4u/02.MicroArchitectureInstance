S3 스토리지 저장 방법과 EBS 대체 불가능한 기술적 사유, 비용적인 측면을 숙지하시기 바랍니다. 

---

## Amazon S3 (Simple Storage Service) 완전 가이드

Amazon S3는 업계 최고 수준의 확장성, 데이터 가용성 및 보안을 제공하는 **객체 스토리지** 서비스입니다. 데이터의 성격에 따라 적절한 스토리지 클래스를 선택하는 것이 비용 최적화의 핵심입니다.

### 1. S3의 데이터 저장 방식: 객체 스토리지 (Object Storage)

S3는 전통적인 운영체제의 파일 시스템(Block/File Storage)과 달리 **객체(Object)** 단위로 데이터를 관리합니다.

* **구조**: 데이터를 '버킷(Bucket)'이라는 컨테이너에 담으며, 각 객체는 **데이터(파일)**, **메타데이터(속성)**, **고유 키(식별자)**로 구성됩니다.
* **접근 방식**: 경로가 아닌 **HTTP/HTTPS 프로토콜**을 통한 API 호출로 데이터를 읽고 씁니다. (예: `https://bucket-name.s3.region.amazonaws.com/key-name`)
* **특징**: 계층 구조가 없는 평면적인 구조이며, 메타데이터를 활용한 데이터 분류 및 검색이 용이합니다.

---

### 2. S3가 EBS를 대체할 수 없는 이유

S3는 훌륭한 저장소이지만, EC2의 주 디스크인 **EBS(Elastic Block Store)**를 완전히 대체할 수 없는 기술적 한계가 있습니다.

1. **데이터 접근 단위 (Block vs Object)**:
* **EBS**: 블록 단위로 수정이 가능합니다. 파일의 1바이트만 바뀌어도 해당 블록만 수정하면 됩니다. 따라서 **운영체제(OS) 설치 및 데이터베이스(DB)** 실행에 필수적입니다.
* **S3**: 객체 전체를 다시 써야 합니다. 1GB 파일에서 1바이트를 수정하려면 1GB 전체를 다시 업로드해야 하므로 실시간 OS 구동이나 DB용으로는 부적합합니다.


2. **연결 방식 및 속도**:
* **EBS**: EC2에 직접 마운트되어 로컬 디스크처럼 작동하며 지연 시간이 매우 낮습니다.
* **S3**: 네트워크(API)를 통해 통신하므로 EBS에 비해 상대적으로 지연 시간(Latency)이 발생합니다.


3. **부팅 불가**: 운영체제는 블록 단위의 읽기/쓰기가 필요하므로 S3에 OS를 설치하여 인스턴스를 부팅할 수 없습니다.

---

### 3. S3 스토리지 클래스별 가격 및 특징 비교 (2026년 서울 리전 기준)

S3는 데이터의 접근 빈도와 보관 기간에 따라 다양한 선택지를 제공합니다. 모든 클래스는 **99.999999999%(11 nines)**의 데이터 내구성을 보장하도록 설계되었습니다.

| 스토리지 클래스 | 월간 저장 요금 (GB당) | 데이터 검색 요금 (GB당) | 최소 보관 기간 | 특징 및 권장 용도 |
| --- | --- | --- | --- | --- |
| **Standard** | **$0.025** | **무료** | 없음 | 자주 접근하는 데이터, 일반 웹 서비스 |
| **Intelligent-Tiering** | **$0.025 / $0.0125** | **무료** | 없음 | 액세스 패턴을 알 수 없는 데이터(자동 최적화) |
| **Standard-IA** | **$0.019** | **$0.01** | 30일 | 가끔 접근하지만 즉시 사용 필요한 데이터(백업 등) |
| **One Zone-IA** | **$0.0152** | **$0.01** | 30일 | 중요도가 낮은 데이터 (단일 AZ 저장으로 20% 저렴) |
| **Glacier Instant** | **$0.005** | **$0.03** | 90일 | 분기별 1회 접근, 밀리초 단위 복구 필요 데이터 |
| **Glacier Flexible** | **$0.0045** | **$0.01** | 90일 | 연 1~2회 접근, 수 분~수 시간 내 복구 가능 데이터 |
| **Glacier Deep Archive** | **$0.00099** | **$0.02** | 180일 | 최저가 계층, 장기 보관용 (최대 12시간 복구) |

---

### 4. 서비스 이용 시 발생하는 추가 요금 (유료)

저장 비용 외에도 다음과 같은 항목에서 **유료 과금**이 발생하므로 설계 시 반드시 고려해야 합니다.

* **API 요청 요금**:
* `PUT, COPY, POST, LIST`: 1,000건당 **$0.005**
* `GET, SELECT`: 1,000건당 **$0.0004**


* **데이터 전송 요금 (Data Transfer Out)**: S3에서 인터넷(사용자)으로 나가는 데이터는 요금이 발생합니다.
* 첫 100GB/월: **무료**
* 이후 10TB까지: **GB당 약 $0.114**



> [!CAUTION]
> **과금 주의**: 프리티어(12개월간 5GB)를 초과하거나, Glacier 클래스 사용 시 최소 보관 기간을 채우지 않고 삭제하면 잔여 기간에 대한 요금이 부과될 수 있습니다.

Next Step: S3 버킷 생성 및 권한 설정(Bucket Policy) 실습

---
AWS S3 구축 및 특정 IP 제한 정책을 적용하는 모든 단계에 대해, 입력되는 코드 및 JSON의 모든 라인에 상세 주석을 추가하여 정리해 드립니다.

---

## S3 버킷 구축 및 IP 기반 접근 제어 가이드

지정된 IP 대역(`192.168.1.0/24`) 외의 모든 접근을 강력하게 차단(Explicit Deny)하는 설정입니다.

### 1. GUI (AWS 관리 콘솔) 구축 및 정책 적용

콘솔에서 정책을 입력할 때는 아래 JSON 형식을 사용합니다. 실무 적용 시에는 `//` 주석 부분을 제거하고 입력해야 합니다.

* **버킷 생성**: S3 콘솔에서 `ss3-data-unique`와 `ss3-backup-unique`를 각각 생성합니다. (리전: 서울)
* **퍼블릭 액세스 차단**: 생성 시 **[모든 퍼블릭 액세스 차단]**이 활성화되어 있는지 확인합니다.
* **정책 입력**: 각 버킷의 [권한] 탭 > [버킷 정책] 편집 창에 아래 JSON을 입력합니다.

#### **[공통] S3 버킷 정책 JSON (상세 주석)**

```json
{
  "Version": "2012-10-17",                              // 정책 언어의 버전을 정의 (최신 표준 버전 유지)
  "Statement": [                                         // 정책의 세부 규칙(구문)을 담는 배열 시작
    {
      "Sid": "IPAllowOnly",                              // 이 정책 구문의 고유 식별자 (임의 지정 가능)
      "Effect": "Deny",                                  // 조건에 맞지 않을 경우 모든 요청을 '거부'함
      "Principal": "*",                                  // 모든 사용자(익명 포함)를 정책 대상으로 설정
      "Action": "s3:*",                                  // 모든 S3 작업(읽기, 쓰기, 삭제 등)을 대상으로 함
      "Resource": [                                      // 정책이 적용될 실제 자원을 지정
        "arn:aws:s3:::ss3-data-unique",                  // 해당 버킷 자체에 대한 접근 제어
        "arn:aws:s3:::ss3-data-unique/*"                // 버킷 내부에 담길 모든 파일(객체)에 대한 제어
      ],
      "Condition": {                                     // 정책이 실행될 특수 조건을 정의
        "NotIpAddress": {                                // 설정한 IP 주소가 '아닌' 경우에만 실행
          "aws:SourceIp": "192.168.1.0/24"               // 허용할 서버 네트워크 대역 (화이트리스트 IP)
        }
      }
    }
  ]
}

```

---

### 2. CLI (명령줄 인터페이스) 구축 방법

CLI는 대량 배포 시 유용합니다. 명령의 모든 옵션과 파라미터에 주석을 추가하였습니다.

```bash
# 1. ss3-data-unique 버킷 생성 (서울 리전 지정)
aws s3api create-bucket \                                # S3 API를 호출하여 새 버킷 생성을 요청함
    --bucket ss3-data-unique \                           # 생성할 버킷의 고유 이름을 지정함
    --region ap-northeast-2 \                            # 명령을 실행할 AWS 리전을 서울로 설정함
    --create-bucket-configuration LocationConstraint=ap-northeast-2 # 서울 리전에 물리적 생성을 위한 제약 조건을 추가함

# 2. ss3-backup-unique 버킷 생성
aws s3api create-bucket \                                # S3 API를 호출하여 백업용 버킷 생성을 요청함
    --bucket ss3-backup-unique \                         # 백업용 버킷의 고유 이름을 지정함
    --region ap-northeast-2 \                            # 리전 위치를 서울로 설정함
    --create-bucket-configuration LocationConstraint=ap-northeast-2 # 해당 리전 인프라에 생성되도록 명시함

# 3. 버킷 정책 적용 (put-bucket-policy 명령어 활용)
aws s3api put-bucket-policy \                            # 특정 버킷에 보안 정책을 저장하기 위한 API 호출
    --bucket ss3-data-unique \                           # 정책을 적용할 대상 버킷 이름을 지정함
    --policy '{                                          # 적용할 정책 내용을 JSON 문자열로 시작함
        "Version": "2012-10-17",                         # 정책 형식의 최신 버전 정의
        "Statement": [{                                  # 정책 구문 설정 시작
            "Effect": "Deny",                            # 조건에 일치하지 않을 경우 강력하게 거부함
            "Principal": "*",                            # 모든 로그인 사용자 및 익명 사용자 대상
            "Action": "s3:*",                            # 모든 S3 액션(조회, 업로드, 삭제)을 차단함
            "Resource": [                                # 정책이 적용될 리소스 경로 지정
                "arn:aws:s3:::ss3-data-unique",          # 대상 버킷 자체
                "arn:aws:s3:::ss3-data-unique/*"         # 버킷 내 모든 하위 데이터
            ],
            "Condition": {                               # 정책 발동을 위한 세부 조건절
                "NotIpAddress": {                        # 지정된 IP가 아닐 경우에만(Not) 실행
                    "aws:SourceIp": "192.168.1.0/24"     # 접근을 허용할 특정 서버 네트워크 대역
                }
            }
        }]
    }'                                                   # JSON 문자열 및 명령어 입력 종료

```

---

### 3. Terraform (IaC) 구축 방법

인프라를 코드로 관리하여 재사용성을 극대화합니다.

**파일명: `s3_storage.tf**`

```hcl
# AWS 프로바이더: 서울 리전 사용 설정
provider "aws" {
  region = "ap-northeast-2" # 한국 리전(서울) 코드 지정
}

# 1. 데이터 전용 버킷 리소스 정의
resource "aws_s3_bucket" "ss3_data" {
  bucket = "ss3-data-unique" # 실제 생성될 버킷 이름 설정
}

# 2. 백업 전용 버킷 리소스 정의
resource "aws_s3_bucket" "ss3_backup" {
  bucket = "ss3-backup-unique" # 실제 생성될 백업용 버킷 이름 설정
}

# 3. 데이터 버킷에 대한 IP 제한 정책 적용
resource "aws_s3_bucket_policy" "ss3_data_policy" {
  bucket = aws_s3_bucket.ss3_data.id # 위에서 정의한 버킷의 ID를 동적 참조

  policy = jsonencode({               # 테라폼 내부 구조를 JSON 형식으로 변환함
    Version = "2012-10-17"            # 정책 문서 표준 버전
    Statement = [{                    # 정책 구문 리스트 시작
      Sid       = "IPRestriction"     # 정책 구문의 식별용 이름
      Effect    = "Deny"              # 조건 부합 시 강력한 거부권 행사
      Principal = "*"                 # 모든 엔티티(사용자/시스템) 대상
      Action    = "s3:*"              # 모든 행위(조회/수정/삭제) 차단
      Resource  = [                   # 정책 적용 대상 리소스 ARN 지정
        aws_s3_bucket.ss3_data.arn,           # 버킷 자체 ARN
        "${aws_s3_bucket.ss3_data.arn}/*"     # 버킷 내 모든 객체 경로
      ]
      Condition = {                   # 정책 발동 조건 설정
        NotIpAddress = {              # 설정한 IP가 아닐 때만 Deny 작동
          "aws:SourceIp" = "192.168.1.0/24" # 접근을 허용할 서버 네트워크 대역
        }
      }
    }]
  })
}

# 4. 백업 버킷에 동일한 정책 적용
resource "aws_s3_bucket_policy" "ss3_backup_policy" {
  bucket = aws_s3_bucket.ss3_backup.id # 백업 버킷 ID 동적 참조
  policy = jsonencode({                 # 정책 내용을 JSON으로 인코딩
    Version = "2012-10-17"
    Statement = [{
      Effect    = "Deny"
      Principal = "*"
      Action    = "s3:*"
      Resource  = [aws_s3_bucket.ss3_backup.arn, "${aws_s3_bucket.ss3_backup.arn}/*"]
      Condition = { NotIpAddress = { "aws:SourceIp" = "192.168.1.0/24" } }
    }]
  })
}

```

---

### 4. 과금 및 주의사항 (유료 서비스 체크)

* **S3 스토리지 비용**: 저장되는 데이터 용량만큼 매월 과금됩니다. (Standard 계층 기준 약 **$0.025/GB**)
* **API 호출 비용**: 버킷 정책을 적용하거나 파일을 조회할 때마다 API 요청 비용이 발생합니다. (1,000건당 약 **$0.005**)
* **네트워크 비용**: 외부(인터넷)에서 S3 데이터를 가져갈 경우 데이터 전송료(Data Transfer Out)가 발생합니다.
* **중요**: `Deny` 정책은 `Allow`보다 우선순위가 높습니다. 관리자의 현재 공인 IP를 실수로 제외하고 등록하면 **콘솔 접근조차 차단**될 수 있으니 적용 전 반드시 확인하십시오.

---

요청하신 대로 CLI를 포함한 모든 코드 라인에 상세 주석을 추가하여 교재용 포맷으로 정리했습니다.

Next Step: s3 버킷 정책 문법 및 예제

---

