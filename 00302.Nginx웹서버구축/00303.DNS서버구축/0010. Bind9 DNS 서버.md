

# Ubuntu 환경에서의 BIND9 DNS 서버 구축

## 1. 개요

**BIND9 (Berkeley Internet Name Domain version 9)**은 리눅스 환경에서 가장 널리 사용되는 DNS(Domain Name System) 소프트웨어이다.

DNS 서버는 역할에 따라 크게 두 가지로 나뉜다.

1. **캐싱 전용 서버 (Caching Name Server):** 도메인 조회 결과를 메모리에 저장하여 응답 속도를 높이고 외부 트래픽을 줄이는 용도 (ISP DNS 역할).
2. **마스터 네임 서버 (Authoritative Name Server):** 특정 도메인(예: `devops.local`)의 IP 정보를 직접 관리하고 응답하는 용도.

본 장에서는 **Ubuntu Server** 환경에서 내부망을 위한 **마스터 네임 서버**를 구축하는 과정을 다룬다.

---

## 2. 패키지 설치

Ubuntu의 공식 저장소(Repository)에서 BIND9 패키지를 설치한다.

```bash
# 1. 패키지 목록 업데이트
sudo apt update

# 2. BIND9 및 유틸리티 설치
sudo apt install bind9 bind9utils bind9-doc -y

```

> **Cost Alert:** BIND9 소프트웨어 자체는 오픈 소스로 **무료**이다. 하지만 이를 AWS EC2와 같은 클라우드 환경에서 운영할 경우 인스턴스 실행 시간에 따른 **컴퓨팅 요금**이 부과된다.

---

## 3. BIND9 설정 파일 구조 (`/etc/bind/`)

설치 후 주요 설정 파일은 `/etc/bind/` 디렉터리에 위치한다.

* `named.conf`: 메인 설정 파일 (거의 수정하지 않음).
* `named.conf.options`: 전역 옵션 설정 (포워더, ACL, 보안 설정).
* `named.conf.local`: 로컬 존(Zone) 정의 파일 (우리가 관리할 도메인 등록).
* `db.*`: 실제 도메인 정보가 담긴 존 파일 (Zone File).

---

## 4. 전역 설정 (`named.conf.options`)

외부 인터넷 연결을 위한 포워더(Forwarder) 설정과 접근 제어 목록(ACL)을 구성한다.

```bash
sudo nano /etc/bind/named.conf.options

```

**수정 내용 예시:**

```bind
acl "trusted" {
        127.0.0.0/8;
        192.168.1.0/24;  # 내부 네트워크 대역 허용
};

options {
        directory "/var/cache/bind";

        # 재귀 쿼리(Recursive Query) 허용 범위 설정
        recursion yes;
        allow-query { trusted; };

        # 외부 도메인 질의 시 사용할 상위 DNS (구글 DNS 예시)
        forwarders {
                8.8.8.8;
                8.8.4.4;
        };

        dnssec-validation auto;
        listen-on-v6 { any; };
};

```

* **acl "trusted":** DNS 질의를 허용할 신뢰할 수 있는 IP 대역을 정의한다. 보안을 위해 반드시 설정해야 한다.
* **forwarders:** 내 서버가 모르는 도메인(예: https://www.google.com/search?q=google.com)을 물어봤을 때 대신 질의를 넘길 외부 DNS 주소다.

---

## 5. 존(Zone) 선언 (`named.conf.local`)

`devops.local`이라는 가상의 도메인을 관리한다고 가정하고, 이를 서버에 등록한다.

```bash
sudo nano /etc/bind/named.conf.local

```

**내용 추가:**

```bind
# 정방향 조회 (도메인 -> IP)
zone "devops.local" {
    type master;
    file "/etc/bind/db.devops.local";
};

# 역방향 조회 (IP -> 도메인) - 선택 사항
# 192.168.1.x 대역을 사용하는 경우 (순서를 거꾸로 기입)
zone "1.168.192.in-addr.arpa" {
    type master;
    file "/etc/bind/db.192";
};

```

---

## 6. 존 파일 생성 (Zone File Creation)

실제 도메인 이름과 IP 주소를 매핑하는 데이터베이스 파일을 생성한다. 기존의 예제 파일을 복사하여 사용하는 것이 편리하다.

### 6.1 정방향 존 파일 생성 (`db.devops.local`)

```bash
# 예제 파일 복사
sudo cp /etc/bind/db.local /etc/bind/db.devops.local
sudo nano /etc/bind/db.devops.local

```

**파일 내용 작성 (예시):**

```bind
;
; BIND data file for devops.local
;
$TTL    604800
@       IN      SOA     ns1.devops.local. admin.devops.local. (
                              2         ; Serial (수정 시마다 숫자 증가 필수)
                         604800         ; Refresh
                          86400         ; Retry
                        2419200         ; Expire
                         604800 )       ; Negative Cache TTL
;
; Name Server 레코드
@       IN      NS      ns1.devops.local.

; A 레코드 (IP 매핑)
@       IN      A       192.168.1.10    ; devops.local 자체의 IP
ns1     IN      A       192.168.1.10    ; 네임서버 IP
www     IN      A       192.168.1.20    ; 웹 서버 IP
db      IN      A       192.168.1.30    ; DB 서버 IP

```

* **SOA:** 권한 시작 레코드. `admin.devops.local.`은 관리자 이메일(`admin@devops.local`)을 의미한다. (골뱅이 대신 점 사용)
* **Serial:** 파일 수정 시 이 숫자를 반드시 증가시켜야 슬레이브 서버나 캐시가 갱신된 정보를 인식한다.

---

## 7. 설정 검증 및 서비스 재시작

작성한 설정 파일에 문법 오류가 없는지 확인한다.

### 7.1 문법 검사 (Syntax Check)

```bash
# 전체 설정 파일 검사
sudo named-checkconf

# 존 파일 검사 (구문: named-checkzone [도메인] [파일경로])
sudo named-checkzone devops.local /etc/bind/db.devops.local

```

* **성공 시:** `OK` 메시지가 출력된다.

### 7.2 서비스 재시작

```bash
sudo systemctl restart bind9
sudo systemctl status bind9

```

---

## 8. 방화벽 설정 및 클라이언트 테스트

### 8.1 방화벽 오픈 (UFW)

DNS는 기본적으로 **53번 포트(UDP/TCP)**를 사용한다.

```bash
sudo ufw allow Bind9
# 또는 sudo ufw allow 53

```

### 8.2 클라이언트 테스트

같은 네트워크에 있는 다른 PC나, 서버 자체에서 `nslookup` 또는 `dig` 명령어로 테스트한다.

**DNS 서버 지정 테스트:**

```bash
# 127.0.0.1(또는 서버 IP)에게 www.devops.local을 물어봄
nslookup www.devops.local 127.0.0.1

```

**정상 응답 예시:**

```text
Server:         127.0.0.1
Address:        127.0.0.1#53

Name:   www.devops.local
Address: 192.168.1.20

```

---

Next Step: BIND9 역방향 조회(Reverse Zone) 설정 및 DNS 레코드 타입(CNAME, MX, TXT) 상세 분석
